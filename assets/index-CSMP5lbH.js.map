{"version":3,"file":"index-CSMP5lbH.js","sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../src/features/color-simulation/utils/deutan-simulator.ts","../../src/lib/color-science/oklab.ts","../../src/features/color-adjustment/components/ColorWheel.tsx","../../src/features/color-adjustment/components/ColorCircles.tsx","../../src/features/color-adjustment/components/ColorSetSelector.tsx","../../src/lib/color-science/color-converter.ts","../../src/features/color-adjustment/ColorAdjuster.tsx","../../src/lib/image-processing/image-processor.ts","../../src/features/image-viewer/components/ImageUploader.tsx","../../src/features/image-viewer/ImageViewer.tsx","../../src/features/camera/CameraCapture.tsx","../../src/features/color-adjustment/components/ColorVolumeViewer3D.tsx","../../src/components/ui/AboutModal.tsx","../../src/features/color-adjustment/components/ColorWheelIcon.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","// deutan_poly_full.ts\r\n// Machado 2009 Deuteranomaly matrices (full 0.0..1.0 step 0.1) → polynomialized (degree=4).\r\n// Provides: simulateDeutanPoly(), daltonizeDeutan().\r\n// Source for matrices: UFRGS page, Table 1 (Deuteranomaly column).\r\n\r\n// ---------- sRGB <-> linear ----------\r\nfunction srgbToLinear(c: number): number {\r\n  return (c <= 0.04045) ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);\r\n}\r\nfunction linearToSrgb(c: number): number {\r\n  return (c <= 0.0031308) ? 12.92 * c : 1.055 * Math.pow(c, 1 / 2.4) - 0.055;\r\n}\r\n\r\n// ---------- Linear algebra helpers ----------\r\ntype Vec3 = [number, number, number];\r\ntype Mat3 = [Vec3, Vec3, Vec3];\r\n\r\nfunction applyMat3(m: Mat3, v: Vec3): Vec3 {\r\n  const [x, y, z] = v;\r\n  return [\r\n    m[0][0] * x + m[0][1] * y + m[0][2] * z,\r\n    m[1][0] * x + m[1][1] * y + m[1][2] * z,\r\n    m[2][0] * x + m[2][1] * y + m[2][2] * z,\r\n  ];\r\n}\r\n\r\nfunction clamp01(x: number): number {\r\n  return Math.max(0, Math.min(1, x));\r\n}\r\n\r\nfunction clamp255(x: number): number {\r\n  return Math.max(0, Math.min(255, Math.round(x)));\r\n}\r\n\r\n// ---------- Polynomial fit (least squares) ----------\r\n// Fit y ≈ Σ_{k=0..d} c_k x^k\r\nfunction polyfitLeastSquares(xs: number[], ys: number[], degree: number): number[] {\r\n  if (xs.length !== ys.length) throw new Error(\"xs and ys must have the same length\");\r\n  const n = xs.length;\r\n  const d = degree;\r\n  if (n < d + 1) throw new Error(`Need at least degree+1 points (got ${n}, degree ${d})`);\r\n\r\n  // Build Vandermonde matrix A and vector b\r\n  const A: number[][] = Array.from({ length: n }, () => Array(d + 1).fill(0));\r\n  const b: number[] = ys.slice();\r\n\r\n  for (let i = 0; i < n; i++) {\r\n    let val = 1;\r\n    for (let j = 0; j <= d; j++) {\r\n      A[i][j] = val;\r\n      val *= xs[i];\r\n    }\r\n  }\r\n\r\n  // Solve normal equations (A^T A) c = A^T b via Gaussian elimination\r\n  const AT = transpose(A);\r\n  const ATA = matMul(AT, A);\r\n  const ATb = matVecMul(AT, b);\r\n\r\n  // Solve ATA * c = ATb\r\n  const c = gaussianSolve(ATA, ATb);\r\n  return c;\r\n}\r\n\r\nfunction transpose(M: number[][]): number[][] {\r\n  const rows = M.length, cols = M[0].length;\r\n  const T = Array.from({ length: cols }, () => Array(rows).fill(0));\r\n  for (let i = 0; i < rows; i++) for (let j = 0; j < cols; j++) T[j][i] = M[i][j];\r\n  return T;\r\n}\r\n\r\nfunction matMul(A: number[][], B: number[][]): number[][] {\r\n  const r = A.length, k = A[0].length, c = B[0].length;\r\n  const out = Array.from({ length: r }, () => Array(c).fill(0));\r\n  for (let i = 0; i < r; i++) {\r\n    for (let j = 0; j < c; j++) {\r\n      let sum = 0;\r\n      for (let t = 0; t < k; t++) sum += A[i][t] * B[t][j];\r\n      out[i][j] = sum;\r\n    }\r\n  }\r\n  return out;\r\n}\r\n\r\nfunction matVecMul(A: number[][], v: number[]): number[] {\r\n  const r = A.length, c = A[0].length;\r\n  const out = Array(r).fill(0);\r\n  for (let i = 0; i < r; i++) {\r\n    let sum = 0;\r\n    for (let j = 0; j < c; j++) sum += A[i][j] * v[j];\r\n    out[i] = sum;\r\n  }\r\n  return out;\r\n}\r\n\r\nfunction gaussianSolve(Ain: number[][], bIn: number[]): number[] {\r\n  // Augment\r\n  const n = Ain.length;\r\n  const A = Ain.map((row, i) => row.concat([bIn[i]]));\r\n\r\n  // Forward elimination\r\n  for (let i = 0; i < n; i++) {\r\n    // Pivot\r\n    let maxRow = i;\r\n    for (let r = i + 1; r < n; r++) if (Math.abs(A[r][i]) > Math.abs(A[maxRow][i])) maxRow = r;\r\n    [A[i], A[maxRow]] = [A[maxRow], A[i]];\r\n\r\n    const pivot = A[i][i];\r\n    if (Math.abs(pivot) < 1e-12) throw new Error(\"Singular matrix in gaussianSolve\");\r\n\r\n    // Normalize row\r\n    for (let j = i; j <= n; j++) A[i][j] /= pivot;\r\n\r\n    // Eliminate\r\n    for (let r = 0; r < n; r++) {\r\n      if (r === i) continue;\r\n      const factor = A[r][i];\r\n      for (let j = i; j <= n; j++) A[r][j] -= factor * A[i][j];\r\n    }\r\n  }\r\n\r\n  // Extract solution\r\n  const x = A.map(row => row[n]);\r\n  return x;\r\n}\r\n\r\n// ---------- Deuteranomaly matrices from Machado2009 Table 1 ----------\r\ntype SamplePoint = { s: number, M: Mat3 };\r\n\r\nconst MACHADO_DEUTERANOMALY: SamplePoint[] = [\r\n  {\r\n    s: 0.0, M: [\r\n      [1.000000, 0.000000, -0.000000],\r\n      [0.000000, 1.000000, 0.000000],\r\n      [-0.000000, -0.000000, 1.000000],\r\n    ]\r\n  },\r\n  {\r\n    s: 0.1, M: [\r\n      [0.866435, 0.177704, -0.044139],\r\n      [0.049567, 0.939063, 0.011370],\r\n      [-0.003453, 0.007233, 0.996220],\r\n    ]\r\n  },\r\n  {\r\n    s: 0.2, M: [\r\n      [0.760729, 0.319078, -0.079807],\r\n      [0.090568, 0.889315, 0.020117],\r\n      [-0.006027, 0.013325, 0.992702],\r\n    ]\r\n  },\r\n  {\r\n    s: 0.3, M: [\r\n      [0.675425, 0.433850, -0.109275],\r\n      [0.125303, 0.847755, 0.026942],\r\n      [-0.007950, 0.018572, 0.989378],\r\n    ]\r\n  },\r\n  {\r\n    s: 0.4, M: [\r\n      [0.605511, 0.528560, -0.134071],\r\n      [0.155318, 0.812366, 0.032316],\r\n      [-0.009376, 0.023176, 0.986200],\r\n    ]\r\n  },\r\n  {\r\n    s: 0.5, M: [\r\n      [0.547494, 0.607765, -0.155259],\r\n      [0.181692, 0.781742, 0.036566],\r\n      [-0.010410, 0.027275, 0.983136],\r\n    ]\r\n  },\r\n  {\r\n    s: 0.6, M: [\r\n      [0.498864, 0.674741, -0.173604],\r\n      [0.205199, 0.754872, 0.039929],\r\n      [-0.011131, 0.030969, 0.980162],\r\n    ]\r\n  },\r\n  {\r\n    s: 0.7, M: [\r\n      [0.457771, 0.731899, -0.189670],\r\n      [0.226409, 0.731012, 0.042579],\r\n      [-0.011595, 0.034333, 0.977261],\r\n    ]\r\n  },\r\n  {\r\n    s: 0.8, M: [\r\n      [0.422823, 0.781057, -0.203881],\r\n      [0.245752, 0.709602, 0.044646],\r\n      [-0.011843, 0.037423, 0.974421],\r\n    ]\r\n  },\r\n  {\r\n    s: 0.9, M: [\r\n      [0.392952, 0.823610, -0.216562],\r\n      [0.263559, 0.690210, 0.046232],\r\n      [-0.011910, 0.040281, 0.971630],\r\n    ]\r\n  },\r\n  {\r\n    s: 1.0, M: [\r\n      [0.367322, 0.860646, -0.227968],\r\n      [0.280085, 0.672501, 0.047413],\r\n      [-0.011820, 0.042940, 0.968881],\r\n    ]\r\n  },\r\n];\r\n\r\n// ---------- Build polynomial coefficients per element ----------\r\ntype CoeffMat = number[][][]; // 3x3 of coefficient arrays [c0..cd]\r\nfunction buildPolynomialCoeffs(data: SamplePoint[], degree: number): CoeffMat {\r\n  if (degree < 1) throw new Error(\"degree must be >= 1\");\r\n  const xs = data.map(p => p.s);\r\n  const coeffs: CoeffMat = [[], [], []] as unknown as CoeffMat;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    coeffs[i] = [];\r\n    for (let j = 0; j < 3; j++) {\r\n      const ys = data.map(p => p.M[i][j]);\r\n      const c = polyfitLeastSquares(xs, ys, degree);\r\n      coeffs[i][j] = c; // length degree+1\r\n    }\r\n  }\r\n  return coeffs;\r\n}\r\n\r\nfunction evalPoly(c: number[], x: number): number {\r\n  // Horner\r\n  let acc = 0;\r\n  for (let k = c.length - 1; k >= 0; k--) acc = acc * x + c[k];\r\n  return acc;\r\n}\r\n\r\nfunction evaluateMatrix(coeffs: CoeffMat, s: number): Mat3 {\r\n  const ss = clamp01(s);\r\n  const M: Mat3 = [[0, 0, 0], [0, 0, 0], [0, 0, 0]] as Mat3;\r\n  for (let i = 0; i < 3; i++) {\r\n    for (let j = 0; j < 3; j++) {\r\n      M[i][j] = evalPoly(coeffs[i][j], ss);\r\n    }\r\n  }\r\n  return M;\r\n}\r\n\r\n// Precompute coefficients\r\nconst DEGREE = 4;\r\nconst COEFFS: CoeffMat = buildPolynomialCoeffs(MACHADO_DEUTERANOMALY, DEGREE);\r\n\r\n// ---------- Public API ----------\r\nexport type RGB8 = [number, number, number];\r\n\r\n/** Simulate Deuteranomaly using polynomialized Machado matrix. */\r\nexport function simulateDeutanPoly(rgb: RGB8, severity: number): RGB8 {\r\n  return createDeutanSimulator(severity)(rgb);\r\n}\r\n\r\n/** \r\n * Returns a function that simulates Deuteranomaly using a pre-calculated matrix.\r\n * Highly optimized for batch processing.\r\n */\r\nexport function createDeutanSimulator(severity: number): (rgb: RGB8) => RGB8 {\r\n  const M = evaluateMatrix(COEFFS, severity);\r\n  return (rgb: RGB8): RGB8 => {\r\n    const lin: Vec3 = [\r\n      srgbToLinear(rgb[0] / 255),\r\n      srgbToLinear(rgb[1] / 255),\r\n      srgbToLinear(rgb[2] / 255),\r\n    ];\r\n    const [R, G, B] = applyMat3(M, lin);\r\n    return [\r\n      clamp255(linearToSrgb(clamp01(R)) * 255),\r\n      clamp255(linearToSrgb(clamp01(G)) * 255),\r\n      clamp255(linearToSrgb(clamp01(B)) * 255),\r\n    ];\r\n  };\r\n}\r\n\r\n/**\r\n * Daltonize for Deuteranomaly via iterative pre-compensation.\r\n * Finds X such that S(X) ≈ Y (Y=original). Performs T steps:\r\n *   X_{k+1} = clip( X_k + alpha * ( Y - S(X_k) ) )\r\n * All operations in linear RGB; final result returned in sRGB 8-bit.\r\n */\r\nexport function daltonizeDeutan(rgb: RGB8, severity: number, alpha = 0.6, steps = 3): RGB8 {\r\n  // to linear\r\n  let X: Vec3 = [\r\n    srgbToLinear(rgb[0] / 255),\r\n    srgbToLinear(rgb[1] / 255),\r\n    srgbToLinear(rgb[2] / 255),\r\n  ];\r\n  const Y: Vec3 = [...X];\r\n  const M = evaluateMatrix(COEFFS, severity);\r\n\r\n  const simulateLin = (v: Vec3): Vec3 => applyMat3(M, v);\r\n\r\n  for (let t = 0; t < steps; t++) {\r\n    const Sx = simulateLin(X);\r\n    // residual towards target Y\r\n    const err: Vec3 = [Y[0] - Sx[0], Y[1] - Sx[1], Y[2] - Sx[2]];\r\n    X = [\r\n      clamp01(X[0] + alpha * err[0]),\r\n      clamp01(X[1] + alpha * err[1]),\r\n      clamp01(X[2] + alpha * err[2]),\r\n    ];\r\n  }\r\n\r\n  return [\r\n    clamp255(linearToSrgb(X[0]) * 255),\r\n    clamp255(linearToSrgb(X[1]) * 255),\r\n    clamp255(linearToSrgb(X[2]) * 255),\r\n  ];\r\n}\r\n\r\n/**\r\n * Green enhancement \"inverse-ish\" filter in linear space.\r\n * This is not a true inverse; it boosts green while attenuating red/blue.\r\n * @param rgb 8-bit sRGB triple [0..255]\r\n * @param strength α in [0,1], typical 0.1~0.3\r\n */\r\nexport function enhanceGreen(rgb: RGB8, strength: number = 0.2): RGB8 {\r\n  const s = Math.max(0, Math.min(1, strength));\r\n  const E: Mat3 = [\r\n    [1 - s, 0, 0],\r\n    [0, 1 + s, 0],\r\n    [0, 0, 1 - s],\r\n  ];\r\n  const [r, g, b] = rgb.map(v => srgbToLinear(v / 255)) as Vec3;\r\n  const [R, G, B] = applyMat3(E, [r, g, b]);\r\n  return [\r\n    clamp255(linearToSrgb(R) * 255),\r\n    clamp255(linearToSrgb(G) * 255),\r\n    clamp255(linearToSrgb(B) * 255),\r\n  ];\r\n}\r\n\r\n/**\r\n * デュータン補正フィルター（Daltonization使用）\r\n */\r\nexport function correctForDeutan(rgb: RGB8, strength: number = 0.2, headroom?: number): RGB8 {\r\n  return createDeutanCorrector(strength, headroom)(rgb);\r\n}\r\n\r\n/**\r\n * Returns a function that corrects for Deuteranomaly using a pre-calculated matrix.\r\n * Highly optimized for batch processing.\r\n */\r\nexport function createDeutanCorrector(strength: number = 0.2, headroom?: number): (rgb: RGB8) => RGB8 {\r\n  const s = Math.max(0, Math.min(1, strength));\r\n  let headroomScale = headroom !== undefined ? 1 - Math.max(0, Math.min(1, headroom)) : 1.0;\r\n  const M = evaluateMatrix(COEFFS, s);\r\n  const gamma = 1.2;\r\n  const blendRatio = Math.pow(s, gamma);\r\n  const TM_START = 0.85, TM_MAX = 0.5;\r\n  const tmStrength = s > TM_START ? TM_MAX * ((s - TM_START) / (1 - TM_START)) : 0;\r\n\r\n  return (rgb: RGB8): RGB8 => {\r\n    // linScaled\r\n    const linOrig: Vec3 = [srgbToLinear(rgb[0] / 255), srgbToLinear(rgb[1] / 255), srgbToLinear(rgb[2] / 255)];\r\n    const linScaled: Vec3 = [linOrig[0] * headroomScale, linOrig[1] * headroomScale, linOrig[2] * headroomScale];\r\n\r\n    // daltonizeDeutan logic inline with pre-calculated M\r\n    const simulateLin = (v: Vec3): Vec3 => applyMat3(M, v);\r\n    let X: Vec3 = [...linScaled];\r\n    const Y: Vec3 = [...linScaled];\r\n    const alpha = 0.6;\r\n    for (let t = 0; t < 3; t++) {\r\n      const Sx = simulateLin(X);\r\n      const err: Vec3 = [Y[0] - Sx[0], Y[1] - Sx[1], Y[2] - Sx[2]];\r\n      X = [\r\n        clamp01(X[0] + alpha * err[0]),\r\n        clamp01(X[1] + alpha * err[1]),\r\n        clamp01(X[2] + alpha * err[2]),\r\n      ];\r\n    }\r\n    const linCorrectedFull = X;\r\n\r\n    // blend\r\n    let linOut: Vec3 = [\r\n      linScaled[0] * (1 - blendRatio) + linCorrectedFull[0] * blendRatio,\r\n      linScaled[1] * (1 - blendRatio) + linCorrectedFull[1] * blendRatio,\r\n      linScaled[2] * (1 - blendRatio) + linCorrectedFull[2] * blendRatio\r\n    ];\r\n\r\n    // tone mapping\r\n    if (s > TM_START) {\r\n      linOut = linOut.map(c => { const mapped = c / (1 + c); return c * (1 - tmStrength) + mapped * tmStrength; }) as Vec3;\r\n    }\r\n\r\n    return [clamp255(linearToSrgb(clamp01(linOut[0])) * 255), clamp255(linearToSrgb(clamp01(linOut[1])) * 255), clamp255(linearToSrgb(clamp01(linOut[2])) * 255)];\r\n  };\r\n}\r\n\r\n/**\r\n * RGB値配列に対するバッチ処理版\r\n * @param rgbArray RGB値の配列\r\n * @param severity デュータンシミュレーション強度\r\n * @returns シミュレーション結果の配列\r\n */\r\nexport function simulateDeutanBatch(rgbArray: RGB8[], severity: number): RGB8[] {\r\n  return rgbArray.map(rgb => simulateDeutanPoly(rgb, severity));\r\n}\r\n\r\n/**\r\n * Canvas ImageDataに対するデュータンシミュレーション\r\n * @param imageData Canvas ImageData\r\n * @param severity シミュレーション強度\r\n * @returns 変換されたImageData\r\n */\r\nexport function simulateDeutanImageData(imageData: ImageData, severity: number): ImageData {\r\n  const data = new Uint8ClampedArray(imageData.data);\r\n\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    const [r, g, b] = simulateDeutanPoly([data[i], data[i + 1], data[i + 2]], severity);\r\n    data[i] = r;\r\n    data[i + 1] = g;\r\n    data[i + 2] = b;\r\n    // alpha channel (data[i + 3]) is preserved\r\n  }\r\n\r\n  return new ImageData(data, imageData.width, imageData.height);\r\n}\r\n","import { RGBColor, OKLabColor } from '@/types/color';\r\n\r\n/**\r\n * sRGB (0-255) to Linear sRGB (0-1)\r\n */\r\nexport function srgbToLinear(c: number): number {\r\n    const v = c / 255;\r\n    return v <= 0.04045 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);\r\n}\r\n\r\n/**\r\n * Linear sRGB (0-1) to sRGB (0-255)\r\n */\r\nexport function linearToSrgb(c: number): number {\r\n    const v = c <= 0.0031308 ? 12.92 * c : 1.055 * Math.pow(c, 1 / 2.4) - 0.055;\r\n    return Math.max(0, Math.min(255, Math.round(v * 255)));\r\n}\r\n\r\n/**\r\n * Oklab to Linear sRGB\r\n */\r\nexport function oklabToLinearSrgb(L: number, a: number, b: number): [number, number, number] {\r\n    const l_ = L + 0.3963377774 * a + 0.2158037573 * b;\r\n    const m_ = L - 0.1055613458 * a - 0.0638541728 * b;\r\n    const s_ = L - 0.0894841775 * a - 1.291485548 * b;\r\n\r\n    const l = l_ * l_ * l_;\r\n    const m = m_ * m_ * m_;\r\n    const s = s_ * s_ * s_;\r\n\r\n    return [\r\n        +4.0767416621 * l - 3.3077115913 * m + 0.2309699292 * s,\r\n        -1.2684380046 * l + 2.6097574011 * m - 0.3413193965 * s,\r\n        -0.0041960863 * l - 0.7034186147 * m + 1.707614701 * s,\r\n    ];\r\n}\r\n\r\n/**\r\n * Linear sRGB to Oklab\r\n */\r\nexport function linearSrgbToOklab(r: number, g: number, b: number): OKLabColor {\r\n    const l = 0.4122214708 * r + 0.5363320363 * g + 0.0514459929 * b;\r\n    const m = 0.2119034982 * r + 0.6806995451 * g + 0.1073969566 * b;\r\n    const s = 0.0883024619 * r + 0.2817188501 * g + 0.6299787041 * b;\r\n\r\n    const l_ = Math.cbrt(l);\r\n    const m_ = Math.cbrt(m);\r\n    const s_ = Math.cbrt(s);\r\n\r\n    return {\r\n        L: 0.2104542553 * l_ + 0.793617785 * m_ - 0.0040720401 * s_,\r\n        a: 1.9779984951 * l_ - 2.428592205 * m_ + 0.4505937099 * s_,\r\n        b: 0.0259040371 * l_ + 0.7827717662 * m_ - 0.808675766 * s_,\r\n    };\r\n}\r\n\r\n/**\r\n * Oklab to RGB (0-255)\r\n */\r\nexport function oklabToRgb(L: number, a: number, b: number): RGBColor {\r\n    const [lr, lg, lb] = oklabToLinearSrgb(L, a, b);\r\n    return {\r\n        r: linearToSrgb(lr),\r\n        g: linearToSrgb(lg),\r\n        b: linearToSrgb(lb),\r\n    };\r\n}\r\n\r\n/**\r\n * RGB (0-255) to Oklab\r\n */\r\nexport function rgbToOklab(r: number, g: number, b: number): OKLabColor {\r\n    return linearSrgbToOklab(\r\n        srgbToLinear(r),\r\n        srgbToLinear(g),\r\n        srgbToLinear(b)\r\n    );\r\n}\r\n\r\n/**\r\n * Checks if an Oklab color is within the sRGB gamut\r\n */\r\nexport function isInGamut(L: number, a: number, b: number): boolean {\r\n    const [lr, lg, lb] = oklabToLinearSrgb(L, a, b);\r\n    // Add a very small epsilon to avoid floating point precision issues at boundaries\r\n    const eps = 0.00001;\r\n    return (\r\n        lr >= -eps && lr <= 1 + eps &&\r\n        lg >= -eps && lg <= 1 + eps &&\r\n        lb >= -eps && lb <= 1 + eps\r\n    );\r\n}\r\n\r\n/**\r\n * Finds the maximum chroma for a given lightness and hue in Oklab space\r\n * using binary search.\r\n */\r\nexport function findMaxChroma(L: number, hue: number): number {\r\n    if (L <= 0 || L >= 1) return 0;\r\n\r\n    let low = 0;\r\n    let high = 0.4; // Max possible chroma in sRGB is roughly 0.32-0.4 depending on hue\r\n\r\n    // 15 iterations give precision of 0.4 / 2^15 ≈ 0.00001\r\n    for (let i = 0; i < 15; i++) {\r\n        const mid = (low + high) / 2;\r\n        const a = mid * Math.cos(hue);\r\n        const b = mid * Math.sin(hue);\r\n        if (isInGamut(L, a, b)) {\r\n            low = mid;\r\n        } else {\r\n            high = mid;\r\n        }\r\n    }\r\n\r\n    return low;\r\n}\r\n","import React, { useRef, useEffect, useState, useCallback } from 'react';\r\nimport type { ColorVisionSettings } from '@/types/color';\r\nimport { simulateDeutanPoly, correctForDeutan } from '@features/color-simulation/utils/deutan-simulator';\r\nimport { oklabToRgb, findMaxChroma } from '@lib/color-science/oklab';\r\n\r\n// HSL to RGB conversion helper\r\nconst hslToRgb = (h: number, s: number, l: number): [number, number, number] => {\r\n  h /= 360;\r\n  s /= 100;\r\n  l /= 100;\r\n  let r, g, b;\r\n\r\n  if (s === 0) {\r\n    r = g = b = l; // achromatic\r\n  } else {\r\n    const hue2rgb = (p: number, q: number, t: number) => {\r\n      if (t < 0) t += 1;\r\n      if (t > 1) t -= 1;\r\n      if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n      if (t < 1 / 2) return q;\r\n      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\r\n      return p;\r\n    };\r\n\r\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n    const p = 2 * l - q;\r\n    r = hue2rgb(p, q, h + 1 / 3);\r\n    g = hue2rgb(p, q, h);\r\n    b = hue2rgb(p, q, h - 1 / 3);\r\n  }\r\n\r\n  return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\r\n};\r\n\r\ninterface ColorInfo {\r\n  hue: number;\r\n  saturation: number;\r\n  lightness: number;\r\n  L?: number; // Oklab coordinates\r\n  a?: number;\r\n  b?: number;\r\n  rgb: [number, number, number];\r\n  position: { x: number; y: number };\r\n  ring: number;\r\n  originalColor: string;\r\n  finalColor: string;\r\n  circleSize: number;\r\n}\r\n\r\ninterface ColorWheelProps {\r\n  colorVisionSettings: ColorVisionSettings;\r\n  width?: number;\r\n  height?: number;\r\n}\r\n\r\ninterface Ripple {\r\n  id: number;\r\n  x: number;\r\n  y: number;\r\n  radius: number;\r\n  opacity: number;\r\n  color: string;\r\n  startTime: number;\r\n  maxRadius: number;\r\n}\r\n\r\ninterface Particle {\r\n  id: number;\r\n  x: number;\r\n  y: number;\r\n  vx: number;\r\n  vy: number;\r\n  life: number;\r\n  maxLife: number;\r\n  size: number;\r\n  color: string;\r\n}\r\n\r\nexport const ColorWheel: React.FC<ColorWheelProps> = ({ colorVisionSettings, width, height }) => {\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const offscreenCanvasRef = useRef<HTMLCanvasElement | null>(null); // Cache for static wheel\r\n\r\n  const [selectedColor, setSelectedColor] = useState<ColorInfo | null>(null);\r\n  const [effectEnabled] = useState<boolean>(true);\r\n  const [colorData, setColorData] = useState<ColorInfo[]>([]);\r\n  const [isInitialized, setIsInitialized] = useState<boolean>(false);\r\n  const defaultSize = Math.min(window.innerWidth - 40, 600);\r\n  const [canvasSize, setCanvasSize] = useState<number>(width || height || defaultSize);\r\n\r\n  // Animation state in refs to avoid re-renders\r\n  const ripplesRef = useRef<Ripple[]>([]);\r\n  const particlesRef = useRef<Particle[]>([]);\r\n  const animationFrameRef = useRef<number>();\r\n\r\n  // 色データ事前計算\r\n  const calculateColorData = useCallback(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return [];\r\n\r\n    // キャンバスサイズ設定（高DPIディスプレイ対応）\r\n    const size = canvasSize;\r\n    const dpr = window.devicePixelRatio || 1;\r\n\r\n    // 実際のキャンバスサイズをDPRで調整\r\n    canvas.width = size * dpr;\r\n    canvas.height = size * dpr;\r\n\r\n    // コンテキストをスケール\r\n    const ctx = canvas.getContext('2d');\r\n    if (ctx) {\r\n      ctx.scale(dpr, dpr);\r\n    }\r\n\r\n    const centerX = size / 2;\r\n    const centerY = size / 2;\r\n    const baseRadius = size / 2 - 20;\r\n\r\n    const newColorData: ColorInfo[] = [];\r\n    const { colorSet } = colorVisionSettings;\r\n\r\n    // ヘルパー: 色覚シミュレーションと補正を適用\r\n    const applyColorVision = (rgb: [number, number, number]): [number, number, number] => {\r\n      let result = [...rgb] as [number, number, number];\r\n      if (colorVisionSettings.simulation.useSimulation &&\r\n        colorVisionSettings.simulation.simulationType === 'deuteranopia') {\r\n        result = simulateDeutanPoly(result, colorVisionSettings.simulation.severity);\r\n      }\r\n      if (colorVisionSettings.correction.useCorrection &&\r\n        colorVisionSettings.correction.correctionType === 'deuteranopia') {\r\n        result = correctForDeutan(result, colorVisionSettings.correction.strength, colorVisionSettings.correction.headroom);\r\n      }\r\n      return result;\r\n    };\r\n\r\n    if (colorSet === 'hsl-standard') {\r\n      const ringRadii = [0.94, 0.743, 0.569, 0.420, 0.293, 0.188].map(r => baseRadius * r);\r\n      const circleSizes = [0.082, 0.070, 0.058, 0.046, 0.036, 0.023].map(s => baseRadius * s);\r\n\r\n      for (let ring = 0; ring < 6; ring++) {\r\n        const radius = ringRadii[ring];\r\n        const circleSize = circleSizes[ring];\r\n        const lightness = 50 + ring * 7;\r\n        const saturation = 100 - ring * 14;\r\n\r\n        for (let i = 0; i < 24; i++) {\r\n          const hue = i * 15;\r\n          const angle = (hue * Math.PI) / 180;\r\n          const x = centerX + Math.cos(angle) * radius;\r\n          const y = centerY + Math.sin(angle) * radius;\r\n\r\n          const rawRgb = hslToRgb(hue, saturation, lightness);\r\n          const finalRgb = applyColorVision(rawRgb);\r\n\r\n          newColorData.push({\r\n            hue, saturation, lightness,\r\n            rgb: finalRgb,\r\n            position: { x, y },\r\n            ring: ring + 1,\r\n            originalColor: `hsl(${hue}, ${saturation}%, ${lightness}%)`,\r\n            finalColor: `rgb(${finalRgb[0]}, ${finalRgb[1]}, ${finalRgb[2]})`,\r\n            circleSize\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      // Oklabベースのセット\r\n      const ringRadii = [0.94, 0.743, 0.569, 0.420, 0.293, 0.188].map(r => baseRadius * r);\r\n      const circleSizes = [0.082, 0.070, 0.058, 0.046, 0.036, 0.023].map(s => baseRadius * s);\r\n\r\n      for (let ring = 0; ring < 6; ring++) {\r\n        const radius = ringRadii[ring];\r\n        const circleSize = circleSizes[ring];\r\n\r\n        // Lの設定: 0.4から0.8まで等間隔\r\n        const L = 0.4 + ring * 0.08;\r\n\r\n        for (let i = 0; i < 24; i++) {\r\n          const hue = (i * 15 * Math.PI) / 180;\r\n          const maxC = findMaxChroma(L, hue);\r\n\r\n          // 彩度の決定: 外側リングほど高い彩度 (バランス重視)\r\n          const chromaSet = maxC * (1.0 - ring * 0.12);\r\n          const a = chromaSet * Math.cos(hue);\r\n          const b = chromaSet * Math.sin(hue);\r\n\r\n          const rawRgbObj = oklabToRgb(L, a, b);\r\n          const rawRgb: [number, number, number] = [rawRgbObj.r, rawRgbObj.g, rawRgbObj.b];\r\n          const finalRgb = applyColorVision(rawRgb);\r\n\r\n          const x = centerX + Math.cos(hue) * radius;\r\n          const y = centerY + Math.sin(hue) * radius;\r\n\r\n          newColorData.push({\r\n            hue: i * 15,\r\n            saturation: Math.round(chromaSet * 250),\r\n            lightness: Math.round(L * 100),\r\n            L, a, b,\r\n            rgb: finalRgb,\r\n            position: { x, y },\r\n            ring: ring + 1,\r\n            originalColor: `oklab(${L.toFixed(2)}, ${a.toFixed(2)}, ${b.toFixed(2)})`,\r\n            finalColor: `rgb(${finalRgb[0]}, ${finalRgb[1]}, ${finalRgb[2]})`,\r\n            circleSize\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    // 中央に白い円を追加\r\n    const centerCircleSize = baseRadius * 0.12;\r\n    const centerRgb = applyColorVision([255, 255, 255]);\r\n    newColorData.push({\r\n      hue: 0,\r\n      saturation: 0,\r\n      lightness: 100,\r\n      rgb: centerRgb,\r\n      position: { x: centerX, y: centerY },\r\n      ring: 0,\r\n      originalColor: 'hsl(0, 0%, 100%)',\r\n      finalColor: `rgb(${centerRgb[0]}, ${centerRgb[1]}, ${centerRgb[2]})`,\r\n      circleSize: centerCircleSize\r\n    });\r\n\r\n    return newColorData;\r\n  }, [colorVisionSettings, canvasSize]);\r\n\r\n  // hex -> RGB変換（#RRGGBB形式）\r\n  const hexToRgb = (hex: string) => {\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n    return result ? {\r\n      r: parseInt(result[1], 16),\r\n      g: parseInt(result[2], 16),\r\n      b: parseInt(result[3], 16)\r\n    } : null;\r\n  };\r\n\r\n\r\n  // RGB -> HSL変換\r\n  const rgbToHsl = (r: number, g: number, b: number) => {\r\n    r /= 255;\r\n    g /= 255;\r\n    b /= 255;\r\n\r\n    const max = Math.max(r, g, b);\r\n    const min = Math.min(r, g, b);\r\n    let h = 0, s = 0;\r\n    const l = (max + min) / 2;\r\n\r\n    if (max !== min) {\r\n      const d = max - min;\r\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n\r\n      switch (max) {\r\n        case r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n        case g: h = (b - r) / d + 2; break;\r\n        case b: h = (r - g) / d + 4; break;\r\n      }\r\n      h /= 6;\r\n    }\r\n\r\n    return { h: h * 360, s: s * 100, l: l * 100 };\r\n  };\r\n\r\n  // ダブルライト効果 - 両側からの色付き照明\r\n  const apply3DLighting = useCallback((ctx: CanvasRenderingContext2D, colorInfo: ColorInfo, circleSize: number, intensity: number) => {\r\n    // Note: This function now runs on the offscreen canvas context\r\n\r\n    // RGB文字列パーサー（関数内に移動）\r\n    const rgbStringToRgb = (rgbString: string) => {\r\n      const match = rgbString.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\r\n      return match ? {\r\n        r: parseInt(match[1], 10),\r\n        g: parseInt(match[2], 10),\r\n        b: parseInt(match[3], 10)\r\n      } : null;\r\n    };\r\n\r\n    // 基本色を取得\r\n    const baseRgb = rgbStringToRgb(colorInfo.finalColor);\r\n    if (!baseRgb) {\r\n      return null;\r\n    }\r\n\r\n    // ダブルライト効果: 直接canvasに描画\r\n    // 左側からピンク/赤の光、右側から青/シアンの光\r\n\r\n    // 現在の描画状態を保存\r\n    ctx.save();\r\n\r\n    // 円形クリッピングマスクを作成（円の形を維持）\r\n    ctx.beginPath();\r\n    ctx.arc(colorInfo.position.x, colorInfo.position.y, circleSize, 0, 2 * Math.PI);\r\n    ctx.clip();\r\n\r\n    // 線形グラデーション: 左（ピンク/赤）から右（青/シアン）\r\n    const gradient = ctx.createLinearGradient(\r\n      colorInfo.position.x - circleSize, // 左端\r\n      colorInfo.position.y,\r\n      colorInfo.position.x + circleSize, // 右端  \r\n      colorInfo.position.y\r\n    );\r\n\r\n    // ダブルライト効果の色計算\r\n    const pinkIntensity = intensity * 0.7;\r\n    const blueIntensity = intensity * 0.7;\r\n\r\n    // 左側のピンク/赤光の色\r\n    const pinkLight = {\r\n      r: Math.min(255, baseRgb.r + (255 - baseRgb.r) * pinkIntensity * 0.8),\r\n      g: Math.min(255, baseRgb.g + (80) * pinkIntensity * 0.4),\r\n      b: Math.min(255, baseRgb.b + (120) * pinkIntensity * 0.4)\r\n    };\r\n\r\n    // 右側の青/シアン光の色\r\n    const blueLight = {\r\n      r: Math.min(255, baseRgb.r + (80) * blueIntensity * 0.4),\r\n      g: Math.min(255, baseRgb.g + (180) * blueIntensity * 0.6),\r\n      b: Math.min(255, baseRgb.b + (255 - baseRgb.b) * blueIntensity * 0.8)\r\n    };\r\n\r\n    // グラデーション設定: 左（ピンク）→中央（元の色）→右（青）\r\n    gradient.addColorStop(0, `rgb(${Math.round(pinkLight.r)}, ${Math.round(pinkLight.g)}, ${Math.round(pinkLight.b)})`);\r\n    gradient.addColorStop(0.5, colorInfo.finalColor); // 中央は元の色\r\n    gradient.addColorStop(1, `rgb(${Math.round(blueLight.r)}, ${Math.round(blueLight.g)}, ${Math.round(blueLight.b)})`);\r\n\r\n    // 円を描画（クリッピングマスク内で）\r\n    ctx.fillStyle = gradient;\r\n    ctx.beginPath();\r\n    ctx.arc(colorInfo.position.x, colorInfo.position.y, circleSize, 0, 2 * Math.PI);\r\n    ctx.fill();\r\n\r\n    // オーバーレイブレンドモードで自然な色の混合\r\n    ctx.globalCompositeOperation = 'overlay';\r\n    ctx.globalAlpha = intensity * 0.3; // 軽いオーバーレイ効果\r\n\r\n    // 再度描画してブレンド効果を適用\r\n    ctx.beginPath();\r\n    ctx.arc(colorInfo.position.x, colorInfo.position.y, circleSize, 0, 2 * Math.PI);\r\n    ctx.fill();\r\n\r\n    // 描画状態を復元\r\n    ctx.restore();\r\n\r\n    // 直接描画したので null を返す（gradientオブジェクトは不要）\r\n    return null;\r\n  }, []);\r\n\r\n  // 遠近感効果\r\n  const applyDepthEffect = useCallback((colorInfo: ColorInfo, intensity: number) => {\r\n    if (!selectedColor) return { color: colorInfo.finalColor, size: 1.0 };\r\n\r\n    // Note: We need canvas width for maxDist calculation. \r\n    // We can use canvasSize * dpr or just canvasSize (logical).\r\n    // Let's use canvasSize (logical) for consistency with previous logic.\r\n    const maxDist = canvasSize * 0.5;\r\n\r\n    // 選択された円からの距離を計算\r\n    const dist = Math.sqrt(\r\n      Math.pow(colorInfo.position.x - selectedColor.position.x, 2) +\r\n      Math.pow(colorInfo.position.y - selectedColor.position.y, 2)\r\n    );\r\n\r\n    const distanceFactor = Math.min(1, dist / maxDist);\r\n\r\n    // 遠いほど彩度を下げ、明度を上げる（霧がかった効果）\r\n    const rgb = hexToRgb(colorInfo.finalColor);\r\n    if (!rgb) return { color: colorInfo.finalColor, size: 1.0 };\r\n\r\n    // 効果を大幅に強化して視覚的に明確にする\r\n    const saturationReduction = distanceFactor * intensity * 0.9; // 0.6 -> 0.9\r\n    const lightnessIncrease = distanceFactor * intensity * 0.6;   // 0.3 -> 0.6\r\n\r\n    // HSLに変換して調整\r\n    const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);\r\n    hsl.s *= (1 - saturationReduction);\r\n    hsl.l = Math.min(100, hsl.l + lightnessIncrease * 100);\r\n\r\n    const adjustedRgb = hslToRgb(hsl.h, hsl.s, hsl.l);\r\n    const adjustedColor = `rgb(${adjustedRgb[0]}, ${adjustedRgb[1]}, ${adjustedRgb[2]})`;\r\n\r\n    // サイズも距離に応じて大幅に調整（近いものは大きく、遠いものは小さく）\r\n    const sizeMultiplier = 1 + (1 - distanceFactor) * intensity * 0.5; // 0.2 -> 0.5\r\n\r\n    return { color: adjustedColor, size: sizeMultiplier };\r\n  }, [selectedColor, canvasSize]);\r\n\r\n  // 特殊効果の適用関数\r\n  const applySpecialEffect = useCallback((ctx: CanvasRenderingContext2D, colorInfo: ColorInfo, circleSize: number) => {\r\n    const { specialEffect } = colorVisionSettings;\r\n    if (!specialEffect.enabled) return { color: colorInfo.finalColor, size: circleSize, gradient: null, skipDrawing: false };\r\n\r\n    let finalColor = colorInfo.finalColor;\r\n    let finalSize = circleSize;\r\n    const gradient = null;\r\n    let skipDrawing = false; // 通常の円描画をスキップするかどうか\r\n\r\n    switch (specialEffect.type) {\r\n      case 'double-light':\r\n        // ダブルライト効果は apply3DLighting で直接描画されるため、通常の描画をスキップ\r\n        apply3DLighting(ctx, colorInfo, circleSize, specialEffect.intensity);\r\n        skipDrawing = true; // 通常の円描画はスキップ\r\n        break;\r\n\r\n      case 'depth': {\r\n        const result = applyDepthEffect(colorInfo, specialEffect.intensity);\r\n        finalColor = result.color;\r\n        finalSize = circleSize * result.size;\r\n        break;\r\n      }\r\n\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return { color: finalColor, size: finalSize, gradient, skipDrawing };\r\n  }, [colorVisionSettings, apply3DLighting, applyDepthEffect]);\r\n\r\n\r\n  // グリッチ効果の描画\r\n  const drawGlitchEffect = (ctx: CanvasRenderingContext2D, colorInfo: ColorInfo, circleSize: number, intensity: number) => {\r\n    const offset = intensity * 4;\r\n\r\n    // まず元の円を描画\r\n    ctx.beginPath();\r\n    ctx.arc(colorInfo.position.x, colorInfo.position.y, circleSize, 0, Math.PI * 2);\r\n    ctx.fillStyle = colorInfo.finalColor;\r\n    ctx.fill();\r\n\r\n    // 半透明でRGBチャンネルをずらして重ねる\r\n    ctx.globalAlpha = 0.6;\r\n\r\n    // 赤チャンネルを右にずらす（赤っぽく）\r\n    ctx.beginPath();\r\n    ctx.arc(colorInfo.position.x + offset, colorInfo.position.y, circleSize, 0, Math.PI * 2);\r\n    ctx.fillStyle = 'rgba(255, 50, 50, 0.4)';\r\n    ctx.fill();\r\n\r\n    // シアンチャンネルを左にずらす（青緑っぽく）\r\n    ctx.beginPath();\r\n    ctx.arc(colorInfo.position.x - offset, colorInfo.position.y, circleSize, 0, Math.PI * 2);\r\n    ctx.fillStyle = 'rgba(50, 255, 255, 0.4)';\r\n    ctx.fill();\r\n\r\n    // より細かいノイズ効果\r\n    if (intensity > 0.5) {\r\n      ctx.globalAlpha = 0.3;\r\n      const smallOffset = offset * 0.3;\r\n\r\n      // 緑チャンネルを上下にずらす\r\n      ctx.beginPath();\r\n      ctx.arc(colorInfo.position.x, colorInfo.position.y - smallOffset, circleSize, 0, Math.PI * 2);\r\n      ctx.fillStyle = 'rgba(50, 255, 50, 0.3)';\r\n      ctx.fill();\r\n\r\n      ctx.beginPath();\r\n      ctx.arc(colorInfo.position.x, colorInfo.position.y + smallOffset, circleSize, 0, Math.PI * 2);\r\n      ctx.fillStyle = 'rgba(255, 50, 255, 0.3)';\r\n      ctx.fill();\r\n    }\r\n\r\n    ctx.globalAlpha = 1.0;\r\n  };\r\n\r\n  // Draw static wheel to offscreen canvas\r\n  const updateOffscreenCanvas = useCallback(() => {\r\n    if (colorData.length === 0) return;\r\n\r\n    // Create offscreen canvas if needed\r\n    if (!offscreenCanvasRef.current) {\r\n      offscreenCanvasRef.current = document.createElement('canvas');\r\n    }\r\n\r\n    const offscreen = offscreenCanvasRef.current;\r\n    const dpr = window.devicePixelRatio || 1;\r\n    const size = canvasSize;\r\n\r\n    // Resize offscreen canvas\r\n    offscreen.width = size * dpr;\r\n    offscreen.height = size * dpr;\r\n\r\n    const ctx = offscreen.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    ctx.scale(dpr, dpr);\r\n\r\n    // ムンカー錯視の背景ストライプ\r\n    const drawMunkerBackgroundStripes = (ctx: CanvasRenderingContext2D, size: number, colorVisionSettings: ColorVisionSettings) => {\r\n      const stripeWidth = Math.max(4, Math.floor(size * 0.015));\r\n      const alpha = Math.min(0.4, colorVisionSettings.specialEffect.intensity * 0.4);\r\n      const stripePattern = colorVisionSettings.specialEffect.details.munker?.stripePattern || 'red-green';\r\n\r\n      // パターンから背景色（最初の色）を決定\r\n      let bgColor;\r\n      switch (stripePattern) {\r\n        case 'red-green':\r\n        case 'red-blue': bgColor = `rgba(255, 60, 60, ${alpha})`; break; // 赤\r\n        case 'green-red':\r\n        case 'green-blue': bgColor = `rgba(60, 255, 60, ${alpha})`; break; // 緑\r\n        case 'blue-red':\r\n        case 'blue-green': bgColor = `rgba(60, 60, 255, ${alpha})`; break; // 青\r\n      }\r\n\r\n      ctx.save();\r\n      ctx.fillStyle = bgColor;\r\n\r\n      // 背景ストライプを描画（奇数位置）\r\n      for (let x = 0; x < size; x += stripeWidth * 2) {\r\n        ctx.fillRect(x, 0, stripeWidth, size);\r\n      }\r\n\r\n      ctx.restore();\r\n    };\r\n\r\n    const drawMunkerForegroundStripes = (ctx: CanvasRenderingContext2D, size: number, colorVisionSettings: ColorVisionSettings) => {\r\n      const stripeWidth = Math.max(4, Math.floor(size * 0.015));\r\n      const alpha = Math.min(0.4, colorVisionSettings.specialEffect.intensity * 0.4);\r\n      const stripePattern = colorVisionSettings.specialEffect.details.munker?.stripePattern || 'red-green';\r\n\r\n      // パターンから前景色（2番目の色）を決定\r\n      let fgColor;\r\n      switch (stripePattern) {\r\n        case 'red-green':\r\n        case 'blue-green': fgColor = `rgba(60, 255, 60, ${alpha})`; break; // 緑\r\n        case 'green-red':\r\n        case 'blue-red': fgColor = `rgba(255, 60, 60, ${alpha})`; break; // 赤\r\n        case 'red-blue':\r\n        case 'green-blue': fgColor = `rgba(60, 60, 255, ${alpha})`; break; // 青\r\n      }\r\n\r\n      ctx.save();\r\n      ctx.fillStyle = fgColor;\r\n\r\n      // 前景ストライプを描画（偶数位置）\r\n      for (let x = stripeWidth; x < size; x += stripeWidth * 2) {\r\n        ctx.fillRect(x, 0, stripeWidth, size);\r\n      }\r\n\r\n      ctx.restore();\r\n    };\r\n\r\n    // 背景を白でクリア\r\n    ctx.fillStyle = '#ffffff';\r\n    ctx.fillRect(0, 0, size, size);\r\n\r\n    // ムンカー錯視: 背景ストライプを最初に描画\r\n    if (colorVisionSettings.specialEffect.enabled && colorVisionSettings.specialEffect.type === 'munker') {\r\n      drawMunkerBackgroundStripes(ctx, size, colorVisionSettings);\r\n    }\r\n\r\n    // リング配置（デスクトップサイズ基準で比率計算）\r\n    const baseRadius = size / 2 - 20;\r\n    const circleSizes = [\r\n      baseRadius * 0.082,  // 54px相当\r\n      baseRadius * 0.070,  // 46px相当\r\n      baseRadius * 0.058,  // 38px相当\r\n      baseRadius * 0.046,  // 30px相当\r\n      baseRadius * 0.036,  // 24px相当\r\n      baseRadius * 0.023,  // 15px相当\r\n    ];\r\n\r\n    // 保存された色データを使って描画\r\n    colorData.forEach(colorInfo => {\r\n      // 中央の白い円は描画しない（クリック領域としてのみ存在）\r\n      if (colorInfo.ring === 0) return;\r\n\r\n      // 通常の円のサイズを決定\r\n      let circleSize = circleSizes[colorInfo.ring - 1];\r\n\r\n      // 特殊効果を適用\r\n      const effectResult = applySpecialEffect(ctx, colorInfo, circleSize);\r\n      circleSize = effectResult.size;\r\n\r\n      // skipDrawingフラグがtrueの場合は通常の描画をスキップ（ダブルライト効果は直接描画済み）\r\n      if (effectResult.skipDrawing) {\r\n        return; // 早期リターンで通常描画をスキップ\r\n      }\r\n\r\n      // ウォーターカラー効果の場合は影を追加\r\n      if (colorVisionSettings.specialEffect.enabled && colorVisionSettings.specialEffect.type === 'watercolor') {\r\n        ctx.shadowColor = effectResult.color;\r\n        ctx.shadowBlur = colorVisionSettings.specialEffect.intensity * 10;\r\n        ctx.shadowOffsetX = 0;\r\n        ctx.shadowOffsetY = 0;\r\n      }\r\n\r\n      // グリッチ効果の場合はチャンネル分離描画\r\n      if (colorVisionSettings.specialEffect.enabled && colorVisionSettings.specialEffect.type === 'glitch') {\r\n        drawGlitchEffect(ctx, colorInfo, circleSize, colorVisionSettings.specialEffect.intensity);\r\n      } else {\r\n        // 通常の円描画\r\n        ctx.beginPath();\r\n        ctx.arc(colorInfo.position.x, colorInfo.position.y, circleSize, 0, Math.PI * 2);\r\n\r\n        // 基本的な球体グラデーション、または平面的な単色塗りつぶし\r\n        ctx.fillStyle = effectResult.color;\r\n        ctx.fill();\r\n      }\r\n\r\n      // 影をリセット\r\n      ctx.shadowBlur = 0;\r\n    });\r\n\r\n    // ムンカー錯視: 前景ストライプを最後に描画\r\n    if (colorVisionSettings.specialEffect.enabled && colorVisionSettings.specialEffect.type === 'munker') {\r\n      drawMunkerForegroundStripes(ctx, size, colorVisionSettings);\r\n    }\r\n  }, [colorData, colorVisionSettings, applySpecialEffect, canvasSize]);\r\n\r\n  // Main Render Loop\r\n  const render = useCallback(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    // 1. Draw Static Wheel from Cache\r\n    if (offscreenCanvasRef.current) {\r\n      // Reset transform to draw full canvas (since offscreen is already scaled)\r\n      const size = canvasSize;\r\n      ctx.drawImage(offscreenCanvasRef.current, 0, 0, size, size);\r\n    }\r\n\r\n    // 2. Update & Draw Effects\r\n    const currentTime = Date.now();\r\n\r\n    // Update Ripples\r\n    ripplesRef.current = ripplesRef.current.map((ripple: Ripple) => {\r\n      const elapsed = currentTime - ripple.startTime;\r\n      const progress = elapsed / 3000;\r\n\r\n      if (progress >= 1) return null;\r\n\r\n      const startRadius = 10;\r\n      const endRadius = ripple.maxRadius || 80;\r\n      // 線形アニメーション（一定速度、水の波紋のように）\r\n      const linearProgress = progress;\r\n\r\n      return {\r\n        ...ripple,\r\n        radius: startRadius + linearProgress * (endRadius - startRadius),\r\n        opacity: Math.exp(-progress * 5) * 1.0, // 指数的に透明度を下げる（3 -> 5）\r\n      };\r\n    }).filter((r: Ripple | null): r is Ripple => r !== null);\r\n\r\n    // Update Particles\r\n    particlesRef.current = particlesRef.current.map((particle: Particle) => {\r\n      const newX = particle.x + particle.vx;\r\n      const newY = particle.y + particle.vy;\r\n      const newLife = particle.life - 1 / particle.maxLife;\r\n\r\n      if (newLife <= 0 ||\r\n        newX < -particle.size || newX > canvas.width + particle.size ||\r\n        newY < -particle.size || newY > canvas.height + particle.size) {\r\n        return null;\r\n      }\r\n\r\n      return {\r\n        ...particle,\r\n        x: newX,\r\n        y: newY,\r\n        life: newLife,\r\n        vx: particle.vx * 0.995,\r\n        vy: particle.vy * 0.995,\r\n      };\r\n    }).filter((p: Particle | null): p is Particle => p !== null);\r\n\r\n    // Draw Ripples\r\n    ripplesRef.current.forEach(ripple => {\r\n      ctx.beginPath();\r\n      ctx.arc(ripple.x, ripple.y, ripple.radius, 0, Math.PI * 2);\r\n      ctx.strokeStyle = ripple.color;\r\n\r\n      const progress = (Date.now() - ripple.startTime) / 3000;\r\n      const lineWidth = Math.max(1.5, 3 * (1 - progress * 0.5));\r\n      ctx.lineWidth = lineWidth;\r\n\r\n      ctx.globalAlpha = ripple.opacity;\r\n      ctx.stroke();\r\n    });\r\n\r\n    // Draw Particles\r\n    particlesRef.current.forEach(particle => {\r\n      if (particle.life > 0.01) {\r\n        ctx.beginPath();\r\n        ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);\r\n        ctx.fillStyle = particle.color;\r\n        ctx.globalAlpha = Math.max(0, particle.life);\r\n        ctx.fill();\r\n        ctx.shadowBlur = 0;\r\n      }\r\n    });\r\n\r\n    ctx.globalAlpha = 1.0;\r\n\r\n    // Continue animation if effects exist\r\n    if (ripplesRef.current.length > 0 || particlesRef.current.length > 0) {\r\n      // Cancel any existing animation frame to prevent duplication\r\n      if (animationFrameRef.current) {\r\n        cancelAnimationFrame(animationFrameRef.current);\r\n      }\r\n      animationFrameRef.current = requestAnimationFrame(render);\r\n    } else {\r\n      animationFrameRef.current = undefined;\r\n    }\r\n  }, [canvasSize]);\r\n\r\n  // 初期化とデータ管理\r\n  useEffect(() => {\r\n    if (!isInitialized) {\r\n      const newColorData = calculateColorData();\r\n      setColorData(newColorData);\r\n      setIsInitialized(true);\r\n    }\r\n  }, [isInitialized, calculateColorData]);\r\n\r\n  // ウィンドウリサイズ監視\r\n  useEffect(() => {\r\n    const handleResize = () => {\r\n      const newSize = Math.min(window.innerWidth - 40, 600);\r\n      setCanvasSize(newSize);\r\n    };\r\n\r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  // 色覚設定変更時の再計算\r\n  useEffect(() => {\r\n    if (isInitialized) {\r\n      const newColorData = calculateColorData();\r\n      setColorData(newColorData);\r\n    }\r\n  }, [colorVisionSettings, calculateColorData, isInitialized]);\r\n\r\n  // Update Offscreen Canvas when data changes\r\n  useEffect(() => {\r\n    if (colorData.length > 0) {\r\n      updateOffscreenCanvas();\r\n      // Force a render to show the updated wheel\r\n      render();\r\n    }\r\n  }, [colorData, updateOffscreenCanvas, render]);\r\n\r\n  // リップルエフェクトを開始\r\n  const startRippleEffect = useCallback((color: ColorInfo) => {\r\n    const maxRadius = 300;\r\n\r\n    const newRipple: Ripple = {\r\n      id: Date.now() + Math.random(),\r\n      x: color.position.x,\r\n      y: color.position.y,\r\n      radius: 10,\r\n      opacity: 1,\r\n      color: color.finalColor,\r\n      startTime: Date.now(),\r\n      maxRadius,\r\n    };\r\n\r\n    ripplesRef.current.push(newRipple);\r\n\r\n    if (!animationFrameRef.current) {\r\n      render();\r\n    }\r\n  }, [render]);\r\n\r\n  // パーティクルエフェクトを開始\r\n  const startParticleEffect = useCallback((color: ColorInfo) => {\r\n    const newParticles: Particle[] = [];\r\n    const particleCount = 8;\r\n\r\n    for (let i = 0; i < particleCount; i++) {\r\n      const angle = (i / particleCount) * Math.PI * 2 + (Math.random() - 0.5) * 0.5;\r\n      // Reduced speed from 3-7 to 1.5-3.5 to match 60fps smooth animation\r\n      const speed = 1.5 + Math.random() * 2;\r\n\r\n      const particleColor = color.ring === 0\r\n        ? '#ffffff'\r\n        : `hsl(${color.hue}, ${Math.min(100, color.saturation + 20)}%, ${Math.min(80, color.lightness + 10)}%)`;\r\n\r\n      const particleSize = color.ring === 0\r\n        ? 4 + Math.random() * 6\r\n        : 2 + Math.random() * 3;\r\n\r\n      newParticles.push({\r\n        id: Date.now() + i,\r\n        x: color.position.x,\r\n        y: color.position.y,\r\n        vx: Math.cos(angle) * speed,\r\n        vy: Math.sin(angle) * speed,\r\n        life: 1,\r\n        // Adjusted maxLife to ensure particles don't last too long with smoother updates\r\n        maxLife: 100 + Math.random() * 50,\r\n        size: particleSize,\r\n        color: particleColor,\r\n      });\r\n    }\r\n\r\n    particlesRef.current.push(...newParticles);\r\n\r\n    if (!animationFrameRef.current) {\r\n      render();\r\n    }\r\n  }, [render]);\r\n\r\n  // クリックイベントハンドラ\r\n  const handleCanvasClick = useCallback((event: React.MouseEvent<HTMLCanvasElement>) => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n\r\n    const rect = canvas.getBoundingClientRect();\r\n    const clickX = event.clientX - rect.left;\r\n    const clickY = event.clientY - rect.top;\r\n\r\n    // キャンバス内の座標に変換（DPR考慮）\r\n    const scaleX = canvasSize / rect.width;\r\n    const scaleY = canvasSize / rect.height;\r\n    const canvasX = clickX * scaleX;\r\n    const canvasY = clickY * scaleY;\r\n\r\n    // 最も近い色円を見つける\r\n    let nearestColor: ColorInfo | null = null;\r\n    let minDistance = Infinity;\r\n\r\n    colorData.forEach((color: ColorInfo) => {\r\n      const distance = Math.sqrt(\r\n        Math.pow(canvasX - color.position.x, 2) +\r\n        Math.pow(canvasY - color.position.y, 2)\r\n      );\r\n      if (distance < minDistance) {\r\n        minDistance = distance;\r\n        nearestColor = color;\r\n      }\r\n    });\r\n\r\n    // 一定距離以内の場合のみ選択\r\n    if (nearestColor && minDistance < 30) {\r\n      // 遠近感効果が有効の場合は常に選択状態を更新\r\n      if (colorVisionSettings.specialEffect.enabled && colorVisionSettings.specialEffect.type === 'depth') {\r\n        setSelectedColor(nearestColor);\r\n        // 遠近感効果の場合はrippleもパーティクルも無効化\r\n        // （遠近感の変化のみを表示）\r\n      } else {\r\n        setSelectedColor(nearestColor);\r\n        // エフェクトが有効の場合はエフェクトを実行\r\n        if (effectEnabled) {\r\n          startRippleEffect(nearestColor);\r\n          startParticleEffect(nearestColor);\r\n        }\r\n      }\r\n    }\r\n  }, [colorData, effectEnabled, startRippleEffect, startParticleEffect, colorVisionSettings, canvasSize]);\r\n\r\n  return (\r\n    <div style={{\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      alignItems: 'center',\r\n      width: '100%'\r\n    }}>\r\n      <div style={{\r\n        position: 'relative',\r\n        width: '100%',\r\n        maxWidth: '600px',\r\n        aspectRatio: '1/1',\r\n        margin: '0 auto'\r\n      }}>\r\n        <canvas\r\n          ref={canvasRef}\r\n          onClick={handleCanvasClick}\r\n          aria-label=\"RGB色調整の視覚化\"\r\n          style={{\r\n            width: '100%',\r\n            height: '100%',\r\n            cursor: 'pointer',\r\n            touchAction: 'none', // スクロール防止\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      {/* 選択された色の情報表示 */}\r\n      {\r\n        selectedColor && (\r\n          <div style={{\r\n            marginTop: '1.5rem',\r\n            padding: '1rem',\r\n            background: '#F9FAFB',\r\n            borderRadius: '0.5rem',\r\n            border: '1px solid #E5E7EB',\r\n            width: '100%',\r\n            maxWidth: '600px',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            gap: '1rem'\r\n          }}>\r\n            <div style={{\r\n              width: '3rem',\r\n              height: '3rem',\r\n              borderRadius: '50%',\r\n              background: selectedColor.finalColor,\r\n              border: '2px solid #D1D5DB',\r\n              boxShadow: '0 2px 4px rgba(0,0,0,0.1)'\r\n            }} />\r\n            <div>\r\n              <div style={{\r\n                fontSize: '0.875rem',\r\n                color: '#6B7280',\r\n                marginBottom: '0.25rem'\r\n              }}>\r\n                選択された色\r\n              </div>\r\n              <div style={{\r\n                fontFamily: 'monospace',\r\n                fontWeight: '600',\r\n                color: '#111827'\r\n              }}>\r\n                {selectedColor.finalColor}\r\n              </div>\r\n              <div style={{\r\n                fontSize: '0.75rem',\r\n                color: '#9CA3AF',\r\n                marginTop: '0.25rem'\r\n              }}>\r\n                {colorVisionSettings.colorSet === 'hsl-standard'\r\n                  ? `H:${selectedColor.hue}° S:${selectedColor.saturation}% L:${selectedColor.lightness}%`\r\n                  : `L:${selectedColor.L?.toFixed(2)} a:${selectedColor.a?.toFixed(2)} b:${selectedColor.b?.toFixed(2)}`\r\n                }\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n    </div >\r\n  );\r\n};","import React from 'react';\r\nimport type { ColorVisionSettings } from '@/types/color';\r\nimport { ColorWheel } from './ColorWheel';\r\n\r\ninterface ColorCirclesProps {\r\n  colorVisionSettings: ColorVisionSettings;\r\n  width?: number;\r\n  height?: number;\r\n}\r\n\r\n/**\r\n * 色相環を表示するコンポーネント（旧RGB円から変更）\r\n * 24色相 × 6リング = 144色を美しく配置\r\n */\r\nexport const ColorCircles: React.FC<ColorCirclesProps> = ({\r\n  colorVisionSettings,\r\n  width,\r\n  height,\r\n}) => {\r\n  return (\r\n    <div\r\n      data-testid=\"color-circles-container\"\r\n      style={{\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        background: 'rgb(255, 255, 255)',\r\n        borderRadius: '1rem',\r\n        boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)',\r\n        padding: '1.5rem',\r\n      }}\r\n    >\r\n      <ColorWheel colorVisionSettings={colorVisionSettings} width={width} height={height} />\r\n      {colorVisionSettings.simulation.showSimulationInfo && (\r\n        <div style={{\r\n          position: 'absolute',\r\n          bottom: '1rem',\r\n          left: '50%',\r\n          transform: 'translateX(-50%)',\r\n          padding: '0.5rem 1rem',\r\n          background: 'rgba(240, 249, 255, 0.95)',\r\n          borderRadius: '0.5rem',\r\n          textAlign: 'center',\r\n          border: '1px solid #bfdbfe',\r\n          backdropFilter: 'blur(4px)',\r\n          boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)',\r\n          pointerEvents: 'none', // クリックイベントを下のcanvasに透過させる\r\n        }}>\r\n          <span style={{\r\n            fontSize: '0.875rem',\r\n            color: '#374151',\r\n            fontWeight: '500'\r\n          }}>\r\n            {colorVisionSettings.simulation.useSimulation && (\r\n              <>\r\n                {colorVisionSettings.simulation.simulationType === 'deuteranopia' && 'デュータン'}\r\n                {colorVisionSettings.simulation.simulationType === 'protanopia' && 'プロタン'}\r\n                {colorVisionSettings.simulation.simulationType === 'tritanopia' && 'トリタン'}\r\n                シミュレーション ({(colorVisionSettings.simulation.severity * 100).toFixed(0)}%)\r\n              </>\r\n            )}\r\n            {colorVisionSettings.correction.useCorrection && (\r\n              <>\r\n                {colorVisionSettings.simulation.useSimulation && ' | '}\r\n                補正フィルター ({(colorVisionSettings.correction.strength * 100).toFixed(0)}%)\r\n              </>\r\n            )}\r\n          </span>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};","import React from 'react';\r\nimport { ColorSetType } from '@/types/color';\r\nimport styles from './ColorSetSelector.module.css';\r\n\r\ninterface ColorSetSelectorProps {\r\n    selectedSet: ColorSetType;\r\n    onSelect: (set: ColorSetType) => void;\r\n}\r\n\r\ninterface ColorSetOption {\r\n    id: ColorSetType;\r\n    label: string;\r\n    description: string;\r\n    isNew?: boolean;\r\n}\r\n\r\nconst colorSetOptions: ColorSetOption[] = [\r\n    {\r\n        id: 'hsl-standard',\r\n        label: 'Standard',\r\n        description: '伝統的なHSL色空間に基づく標準的なカラーセットです。',\r\n    },\r\n    {\r\n        id: 'oklab',\r\n        label: 'Oklab (Perceptual)',\r\n        description: '知覚的に均一なOklab空間を使用した、モダンで正確なカラーセットです。',\r\n        isNew: true,\r\n    },\r\n];\r\n\r\nexport const ColorSetSelector: React.FC<ColorSetSelectorProps> = ({\r\n    selectedSet,\r\n    onSelect,\r\n}) => {\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.title}>カラーセットの選択</div>\r\n            <div className={styles.selectorGrid}>\r\n                {colorSetOptions.map((option) => (\r\n                    <button\r\n                        key={option.id}\r\n                        className={`${styles.option} ${selectedSet === option.id ? styles.optionActive : ''\r\n                            }`}\r\n                        onClick={() => onSelect(option.id)}\r\n                        type=\"button\"\r\n                    >\r\n                        {option.isNew && <span className={styles.badge}>NEW</span>}\r\n                        <span className={styles.optionLabel}>{option.label}</span>\r\n                        <span className={styles.optionDescription}>{option.description}</span>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import type { RGBColor, HSLColor } from '@/types/color';\r\n\r\n/**\r\n * RGB値を16進数カラーコードに変換\r\n */\r\nexport function rgbToHex(rgb: RGBColor): string {\r\n  const toHex = (n: number): string => {\r\n    const hex = Math.round(n).toString(16).padStart(2, '0');\r\n    return hex;\r\n  };\r\n  return `#${toHex(rgb.r)}${toHex(rgb.g)}${toHex(rgb.b)}`;\r\n}\r\n\r\n/**\r\n * 16進数カラーコードをRGB値に変換\r\n */\r\nexport function hexToRgb(hex: string): RGBColor | null {\r\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n  return result\r\n    ? {\r\n      r: parseInt(result[1], 16),\r\n      g: parseInt(result[2], 16),\r\n      b: parseInt(result[3], 16),\r\n    }\r\n    : null;\r\n}\r\n\r\n/**\r\n * RGB値をHSL色空間に変換\r\n */\r\nexport function rgbToHsl(rgb: RGBColor): HSLColor {\r\n  const r = rgb.r / 255;\r\n  const g = rgb.g / 255;\r\n  const b = rgb.b / 255;\r\n\r\n  const max = Math.max(r, g, b);\r\n  const min = Math.min(r, g, b);\r\n  let h = 0;\r\n  let s = 0;\r\n  const l = (max + min) / 2;\r\n\r\n  if (max !== min) {\r\n    const d = max - min;\r\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n\r\n    switch (max) {\r\n      case r:\r\n        h = ((g - b) / d + (g < b ? 6 : 0)) / 6;\r\n        break;\r\n      case g:\r\n        h = ((b - r) / d + 2) / 6;\r\n        break;\r\n      case b:\r\n        h = ((r - g) / d + 4) / 6;\r\n        break;\r\n    }\r\n  }\r\n\r\n  return {\r\n    h: Math.round(h * 360),\r\n    s: Math.round(s * 100),\r\n    l: Math.round(l * 100),\r\n  };\r\n}\r\n\r\n/**\r\n * HSL色空間をRGB値に変換\r\n */\r\nexport function hslToRgb(hsl: HSLColor): RGBColor {\r\n  const h = hsl.h / 360;\r\n  const s = hsl.s / 100;\r\n  const l = hsl.l / 100;\r\n\r\n  let r: number, g: number, b: number;\r\n\r\n  if (s === 0) {\r\n    r = g = b = l;\r\n  } else {\r\n    const hue2rgb = (p: number, q: number, t: number): number => {\r\n      if (t < 0) t += 1;\r\n      if (t > 1) t -= 1;\r\n      if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n      if (t < 1 / 2) return q;\r\n      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\r\n      return p;\r\n    };\r\n\r\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n    const p = 2 * l - q;\r\n\r\n    r = hue2rgb(p, q, h + 1 / 3);\r\n    g = hue2rgb(p, q, h);\r\n    b = hue2rgb(p, q, h - 1 / 3);\r\n  }\r\n\r\n  return {\r\n    r: Math.round(r * 255),\r\n    g: Math.round(g * 255),\r\n    b: Math.round(b * 255),\r\n  };\r\n}\r\n\r\n/**\r\n * 値を指定範囲内にクランプ\r\n */\r\nexport function clamp(value: number, min: number, max: number): number {\r\n  return Math.min(Math.max(value, min), max);\r\n}\r\n\r\n/**\r\n * ガンマ補正を適用\r\n */\r\nexport function applyGammaCorrection(value: number, gamma = 2.2): number {\r\n  return Math.pow(value / 255, gamma) * 255;\r\n}\r\n\r\n/**\r\n * 逆ガンマ補正を適用\r\n */\r\nexport function applyInverseGammaCorrection(value: number, gamma = 2.2): number {\r\n  return Math.pow(value / 255, 1 / gamma) * 255;\r\n}","import React, { useCallback } from 'react';\nimport { ColorSetSelector } from './components/ColorSetSelector';\nimport type { ColorVisionSettings, ColorVisionType, SpecialEffectType, ColorSetType } from '@/types/color';\nimport { clamp } from '@lib/color-science/color-converter';\n\ninterface ColorAdjusterProps {\n  colorVisionSettings: ColorVisionSettings;\n  onColorVisionSettingsChange: (settings: ColorVisionSettings) => void;\n}\n\n/**\n * 色覚シミュレーション・補正設定コンポーネント\n */\nexport const ColorAdjuster: React.FC<ColorAdjusterProps> = ({\n  colorVisionSettings,\n  onColorVisionSettingsChange,\n}) => {\n\n  // 色セットの変更\n  const handleColorSetChange = useCallback((colorSet: ColorSetType) => {\n    onColorVisionSettingsChange({\n      ...colorVisionSettings,\n      colorSet,\n    });\n  }, [colorVisionSettings, onColorVisionSettingsChange]);\n\n  // シミュレーション設定の変更\n  const handleSimulationToggle = useCallback(() => {\n    onColorVisionSettingsChange({\n      ...colorVisionSettings,\n      simulation: {\n        ...colorVisionSettings.simulation,\n        useSimulation: !colorVisionSettings.simulation.useSimulation,\n      },\n    });\n  }, [colorVisionSettings, onColorVisionSettingsChange]);\n\n  const handleSimulationTypeChange = useCallback((type: ColorVisionType) => {\n    onColorVisionSettingsChange({\n      ...colorVisionSettings,\n      simulation: {\n        ...colorVisionSettings.simulation,\n        simulationType: type,\n      },\n    });\n  }, [colorVisionSettings, onColorVisionSettingsChange]);\n\n  const handleSimulationSeverityChange = useCallback((severity: number) => {\n    onColorVisionSettingsChange({\n      ...colorVisionSettings,\n      simulation: {\n        ...colorVisionSettings.simulation,\n        severity: clamp(severity, 0, 1),\n      },\n    });\n  }, [colorVisionSettings, onColorVisionSettingsChange]);\n\n  // 補正設定の変更\n  const handleCorrectionToggle = useCallback(() => {\n    onColorVisionSettingsChange({\n      ...colorVisionSettings,\n      correction: {\n        ...colorVisionSettings.correction,\n        useCorrection: !colorVisionSettings.correction.useCorrection,\n      },\n    });\n  }, [colorVisionSettings, onColorVisionSettingsChange]);\n\n  const handleCorrectionTypeChange = useCallback((type: ColorVisionType) => {\n    onColorVisionSettingsChange({\n      ...colorVisionSettings,\n      correction: {\n        ...colorVisionSettings.correction,\n        correctionType: type,\n      },\n    });\n  }, [colorVisionSettings, onColorVisionSettingsChange]);\n\n  const handleCorrectionStrengthChange = useCallback((strength: number) => {\n    onColorVisionSettingsChange({\n      ...colorVisionSettings,\n      correction: {\n        ...colorVisionSettings.correction,\n        strength: clamp(strength, 0, 1),\n      },\n    });\n  }, [colorVisionSettings, onColorVisionSettingsChange]);\n\n  const handleCorrectionHeadroomChange = useCallback((headroom: number | undefined) => {\n    onColorVisionSettingsChange({\n      ...colorVisionSettings,\n      correction: {\n        ...colorVisionSettings.correction,\n        headroom: headroom !== undefined ? clamp(headroom, 0, 1) : undefined,\n      },\n    });\n  }, [colorVisionSettings, onColorVisionSettingsChange]);\n\n  // 特殊効果設定の変更\n  const handleSpecialEffectToggle = useCallback(() => {\n    onColorVisionSettingsChange({\n      ...colorVisionSettings,\n      specialEffect: {\n        ...colorVisionSettings.specialEffect,\n        enabled: !colorVisionSettings.specialEffect.enabled,\n      },\n    });\n  }, [colorVisionSettings, onColorVisionSettingsChange]);\n\n  const handleSpecialEffectTypeChange = useCallback((type: SpecialEffectType) => {\n    onColorVisionSettingsChange({\n      ...colorVisionSettings,\n      specialEffect: {\n        ...colorVisionSettings.specialEffect,\n        type,\n      },\n    });\n  }, [colorVisionSettings, onColorVisionSettingsChange]);\n\n  const handleSpecialEffectIntensityChange = useCallback((intensity: number) => {\n    onColorVisionSettingsChange({\n      ...colorVisionSettings,\n      specialEffect: {\n        ...colorVisionSettings.specialEffect,\n        intensity: clamp(intensity, 0, 1),\n      },\n    });\n  }, [colorVisionSettings, onColorVisionSettingsChange]);\n\n\n\n\n  return (\n    <div style={{\n      background: '#FFFFFF',\n      borderRadius: '1rem',\n      padding: '1.5rem',\n      boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)',\n      maxWidth: '500px',\n      width: '100%'\n    }}>\n      <h2 style={{\n        fontSize: '1.25rem',\n        fontWeight: '600',\n        marginBottom: '1rem',\n        color: '#1e293b',\n        textAlign: 'center'\n      }}>表示設定</h2>\n\n      <ColorSetSelector\n        selectedSet={colorVisionSettings.colorSet}\n        onSelect={handleColorSetChange}\n      />\n\n      {/* 色覚シミュレーション設定 */}\n      <div style={{\n        marginBottom: '2rem',\n        padding: '1rem',\n        background: '#f8fafc',\n        borderRadius: '0.5rem',\n        border: '1px solid #e2e8f0'\n      }}>\n        <h3 style={{\n          fontSize: '1rem',\n          margin: '0 0 1rem 0',\n          color: '#374151'\n        }}>色覚シミュレーション</h3>\n\n        <div style={{ marginBottom: '1rem' }}>\n          <label style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: '0.5rem',\n            cursor: 'pointer'\n          }}>\n            <input\n              type=\"checkbox\"\n              checked={colorVisionSettings.simulation.useSimulation}\n              onChange={handleSimulationToggle}\n              style={{ accentColor: '#3B82F6' }}\n            />\n            <span style={{ fontSize: '0.875rem', fontWeight: '500' }}>\n              色覚シミュレーションを有効にする\n            </span>\n          </label>\n        </div>\n\n        {colorVisionSettings.simulation.useSimulation && (\n          <>\n            <div style={{ marginBottom: '1rem' }}>\n              <label style={{\n                display: 'block',\n                fontSize: '0.875rem',\n                fontWeight: '500',\n                marginBottom: '0.5rem'\n              }}>\n                シミュレーションタイプ:\n              </label>\n              <select\n                value={colorVisionSettings.simulation.simulationType}\n                onChange={(e) => handleSimulationTypeChange(e.target.value as ColorVisionType)}\n                style={{\n                  width: '100%',\n                  padding: '0.5rem',\n                  border: '1px solid #D1D5DB',\n                  borderRadius: '0.375rem',\n                  fontSize: '0.875rem'\n                }}\n              >\n                <option value=\"deuteranopia\">デュータン（緑色覚異常）</option>\n                <option value=\"protanopia\">プロタン（赤色覚異常）</option>\n                <option value=\"tritanopia\">トリタン（青色覚異常）</option>\n              </select>\n            </div>\n\n            <div style={{ marginBottom: '1rem' }}>\n              <label style={{\n                display: 'block',\n                fontSize: '0.875rem',\n                fontWeight: '500',\n                marginBottom: '0.5rem'\n              }}>\n                シミュレーション強度: {(colorVisionSettings.simulation.severity * 100).toFixed(0)}%\n              </label>\n              <input\n                type=\"range\"\n                min=\"0\"\n                max=\"1\"\n                step=\"0.1\"\n                value={colorVisionSettings.simulation.severity}\n                onChange={(e) => handleSimulationSeverityChange(Number(e.target.value))}\n                style={{\n                  width: '100%',\n                  height: '6px'\n                }}\n              />\n            </div>\n          </>\n        )}\n      </div>\n\n      {/* 色覚補正設定 */}\n      <div style={{\n        marginBottom: '2rem',\n        padding: '1rem',\n        background: '#fff7ed',\n        borderRadius: '0.5rem',\n        border: '1px solid #fed7aa'\n      }}>\n        <h3 style={{\n          fontSize: '1rem',\n          margin: '0 0 1rem 0',\n          color: '#374151'\n        }}>色覚補正フィルター</h3>\n\n        <div style={{ marginBottom: '1rem' }}>\n          <label style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: '0.5rem',\n            cursor: 'pointer'\n          }}>\n            <input\n              type=\"checkbox\"\n              checked={colorVisionSettings.correction.useCorrection}\n              onChange={handleCorrectionToggle}\n              style={{ accentColor: '#ea580c' }}\n            />\n            <span style={{ fontSize: '0.875rem', fontWeight: '500' }}>\n              色覚補正を有効にする\n            </span>\n          </label>\n        </div>\n\n        {colorVisionSettings.correction.useCorrection && (\n          <>\n            <div style={{ marginBottom: '1rem' }}>\n              <label style={{\n                display: 'block',\n                fontSize: '0.875rem',\n                fontWeight: '500',\n                marginBottom: '0.5rem'\n              }}>\n                補正対象:\n              </label>\n              <select\n                value={colorVisionSettings.correction.correctionType}\n                onChange={(e) => handleCorrectionTypeChange(e.target.value as ColorVisionType)}\n                style={{\n                  width: '100%',\n                  padding: '0.5rem',\n                  border: '1px solid #D1D5DB',\n                  borderRadius: '0.375rem',\n                  fontSize: '0.875rem'\n                }}\n              >\n                <option value=\"deuteranopia\">デュータン（緑色覚異常）</option>\n                <option value=\"protanopia\">プロタン（赤色覚異常）</option>\n                <option value=\"tritanopia\">トリタン（青色覚異常）</option>\n              </select>\n            </div>\n\n            <div style={{ marginBottom: '1rem' }}>\n              <label style={{\n                display: 'block',\n                fontSize: '0.875rem',\n                fontWeight: '500',\n                marginBottom: '0.5rem'\n              }}>\n                補正強度: {(colorVisionSettings.correction.strength * 100).toFixed(0)}%\n              </label>\n              <input\n                type=\"range\"\n                min=\"0\"\n                max=\"1\"\n                step=\"0.1\"\n                value={colorVisionSettings.correction.strength}\n                onChange={(e) => handleCorrectionStrengthChange(Number(e.target.value))}\n                style={{\n                  width: '100%',\n                  height: '6px'\n                }}\n              />\n            </div>\n\n            <div style={{ marginBottom: '1rem' }}>\n              <div style={{\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'space-between',\n                marginBottom: '0.5rem'\n              }}>\n                <label style={{\n                  display: 'block',\n                  fontSize: '0.875rem',\n                  fontWeight: '500'\n                }}>\n                  飽和防止: {colorVisionSettings.correction.headroom !== undefined ? (colorVisionSettings.correction.headroom * 100).toFixed(0) + '%' : '自動'}\n                </label>\n                {colorVisionSettings.correction.headroom !== undefined && (\n                  <button\n                    onClick={() => handleCorrectionHeadroomChange(undefined)}\n                    style={{\n                      padding: '0.25rem 0.5rem',\n                      fontSize: '0.875rem',\n                      background: '#E5E7EB',\n                      border: 'none',\n                      borderRadius: '0.25rem',\n                      cursor: 'pointer'\n                    }}\n                  >\n                    自動に戻す\n                  </button>\n                )}\n              </div>\n              <input\n                type=\"range\"\n                min=\"0\"\n                max=\"1\"\n                step=\"0.05\"\n                value={colorVisionSettings.correction.headroom ?? 0.0}\n                onChange={(e) => handleCorrectionHeadroomChange(Number(e.target.value))}\n                style={{\n                  width: '100%',\n                  height: '6px'\n                }}\n              />\n              <div style={{\n                fontSize: '0.875rem',\n                color: '#6B7280',\n                marginTop: '0.25rem'\n              }}>\n                鮮やかな色が飽和（潰れる）のを防ぎます（0%=防止しない、100%=最大限防止）\n              </div>\n            </div>\n          </>\n        )}\n      </div>\n\n      {/* 特殊視覚効果設定 */}\n      <div style={{\n        marginBottom: '2rem',\n        padding: '1rem',\n        background: '#f3f4ff',\n        borderRadius: '0.5rem',\n        border: '1px solid #c7d2fe'\n      }}>\n        <h3 style={{\n          fontSize: '1rem',\n          margin: '0 0 1rem 0',\n          color: '#374151'\n        }}>特殊視覚効果</h3>\n\n        <div style={{ marginBottom: '1rem' }}>\n          <label style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: '0.5rem',\n            cursor: 'pointer'\n          }}>\n            <input\n              type=\"checkbox\"\n              checked={colorVisionSettings.specialEffect.enabled}\n              onChange={handleSpecialEffectToggle}\n              style={{ accentColor: '#7c3aed' }}\n            />\n            <span style={{ fontSize: '0.875rem', fontWeight: '500' }}>\n              特殊視覚効果を有効にする\n            </span>\n          </label>\n        </div>\n\n        {colorVisionSettings.specialEffect.enabled && (\n          <>\n            <div style={{ marginBottom: '1rem' }}>\n              <label style={{\n                display: 'block',\n                fontSize: '0.875rem',\n                fontWeight: '500',\n                marginBottom: '0.5rem'\n              }}>\n                効果タイプ:\n              </label>\n              <select\n                value={colorVisionSettings.specialEffect.type}\n                onChange={(e) => handleSpecialEffectTypeChange(e.target.value as SpecialEffectType)}\n                style={{\n                  width: '100%',\n                  padding: '0.5rem',\n                  border: '1px solid #D1D5DB',\n                  borderRadius: '0.375rem',\n                  fontSize: '0.875rem'\n                }}\n              >\n                <option value=\"double-light\">💡 ダブルライト効果</option>\n                <option value=\"glitch\">🔸 グリッチ効果</option>\n                <option value=\"depth\">🎯 遠近感効果</option>\n                <option value=\"watercolor\">🎨 ウォーターカラー効果</option>\n                <option value=\"munker\">📐 ムンカー錯視</option>\n              </select>\n            </div>\n\n            <div style={{ marginBottom: '1rem' }}>\n              <label style={{\n                display: 'block',\n                fontSize: '0.875rem',\n                fontWeight: '500',\n                marginBottom: '0.5rem'\n              }}>\n                効果強度: {(colorVisionSettings.specialEffect.intensity * 100).toFixed(0)}%\n              </label>\n              <input\n                type=\"range\"\n                min=\"0\"\n                max=\"1\"\n                step=\"0.1\"\n                value={colorVisionSettings.specialEffect.intensity}\n                onChange={(e) => handleSpecialEffectIntensityChange(Number(e.target.value))}\n                style={{\n                  width: '100%',\n                  height: '6px'\n                }}\n              />\n            </div>\n\n            {/* ムンカー錯視専用の色パターン選択 */}\n            {colorVisionSettings.specialEffect.type === 'munker' && (\n              <div style={{ marginBottom: '1rem' }}>\n                <label style={{\n                  display: 'block',\n                  fontSize: '0.875rem',\n                  fontWeight: '500',\n                  marginBottom: '0.5rem'\n                }}>\n                  ストライプ色パターン:\n                </label>\n                <select\n                  value={colorVisionSettings.specialEffect.details.munker?.stripePattern || 'red-green'}\n                  onChange={(e) => {\n                    const newPattern = e.target.value as 'red-green' | 'green-red' | 'red-blue' | 'blue-red' | 'green-blue' | 'blue-green';\n                    onColorVisionSettingsChange({\n                      ...colorVisionSettings,\n                      specialEffect: {\n                        ...colorVisionSettings.specialEffect,\n                        details: {\n                          ...colorVisionSettings.specialEffect.details,\n                          munker: {\n                            stripeWidth: colorVisionSettings.specialEffect.details.munker?.stripeWidth || 8,\n                            stripePattern: newPattern\n                          }\n                        }\n                      }\n                    });\n                  }}\n                  style={{\n                    width: '100%',\n                    padding: '0.5rem',\n                    border: '1px solid #D1D5DB',\n                    borderRadius: '0.375rem',\n                    fontSize: '0.875rem'\n                  }}\n                >\n                  <option value=\"red-green\">🔴Bottom 🟢Top</option>\n                  <option value=\"green-red\">🟢Bottom 🔴Top</option>\n                  <option value=\"red-blue\">🔴Bottom 🔵Top</option>\n                  <option value=\"blue-red\">🔵Bottom 🔴Top</option>\n                  <option value=\"green-blue\">🟢Bottom 🔵Top</option>\n                  <option value=\"blue-green\">🔵Bottom 🟢Top</option>\n                </select>\n              </div>\n            )}\n\n            {/* 効果の説明テキスト */}\n            <div style={{\n              fontSize: '0.875rem',\n              color: '#6b7280',\n              background: 'rgba(255,255,255,0.5)',\n              padding: '0.5rem',\n              borderRadius: '0.25rem',\n              marginTop: '1rem'\n            }}>\n              {colorVisionSettings.specialEffect.type === 'double-light' &&\n                '2つの光源から照らされているような効果を追加します'}\n              {colorVisionSettings.specialEffect.type === 'glitch' &&\n                '映像のバグのような色ズレやノイズを意図的に加えます'}\n              {colorVisionSettings.specialEffect.type === 'depth' &&\n                '遠近感を色で表現し、選択した円を近くに見せます'}\n              {colorVisionSettings.specialEffect.type === 'watercolor' &&\n                '境界線の色が内側ににじんで見えるような効果を追加します'}\n              {colorVisionSettings.specialEffect.type === 'munker' &&\n                '背景のストライプパターンにより色が違って見える錯視効果'}\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};","import { simulateDeutanPoly, correctForDeutan, type RGB8 } from '@features/color-simulation/utils/deutan-simulator';\r\nimport type { ColorVisionSettings } from '@/types/color';\r\n\r\n/**\r\n * 画像に色変換を適用\r\n * @param imageData Canvas ImageData\r\n * @param colorVisionSettings 色覚設定\r\n * @param onProgress 進捗コールバック\r\n * @returns 変換されたImageData\r\n */\r\nexport async function processImageData(\r\n  imageData: ImageData,\r\n  colorVisionSettings: ColorVisionSettings,\r\n  onProgress?: (progress: number) => void\r\n): Promise<ImageData> {\r\n  const data = new Uint8ClampedArray(imageData.data);\r\n  const totalPixels = data.length / 4;\r\n  const batchSize = Math.max(1000, Math.floor(totalPixels / 100)); // バッチサイズ調整\r\n\r\n  let processedPixels = 0;\r\n\r\n  // バッチ処理でメインスレッドをブロックしないように\r\n  for (let i = 0; i < data.length; i += batchSize * 4) {\r\n    const endIndex = Math.min(i + batchSize * 4, data.length);\r\n\r\n    // バッチ内のピクセルを処理\r\n    for (let j = i; j < endIndex; j += 4) {\r\n      const originalRgb: RGB8 = [data[j], data[j + 1], data[j + 2]];\r\n      let transformedRgb = originalRgb;\r\n\r\n      // シミュレーションを適用\r\n      if (colorVisionSettings.simulation.useSimulation &&\r\n        colorVisionSettings.simulation.simulationType === 'deuteranopia') {\r\n        transformedRgb = simulateDeutanPoly(\r\n          transformedRgb,\r\n          colorVisionSettings.simulation.severity\r\n        );\r\n      }\r\n\r\n      // 補正を適用\r\n      if (colorVisionSettings.correction.useCorrection &&\r\n        colorVisionSettings.correction.correctionType === 'deuteranopia') {\r\n        transformedRgb = correctForDeutan(\r\n          transformedRgb,\r\n          colorVisionSettings.correction.strength,\r\n          colorVisionSettings.correction.headroom\r\n        );\r\n      }\r\n\r\n      // 結果を書き戻し\r\n      data[j] = transformedRgb[0];\r\n      data[j + 1] = transformedRgb[1];\r\n      data[j + 2] = transformedRgb[2];\r\n      // alpha channel (data[j + 3]) はそのまま\r\n\r\n      processedPixels++;\r\n    }\r\n\r\n    // 進捗を報告\r\n    if (onProgress) {\r\n      const progress = Math.round((processedPixels / totalPixels) * 100);\r\n      onProgress(progress);\r\n    }\r\n\r\n    // メインスレッドに制御を戻す\r\n    await new Promise(resolve => setTimeout(resolve, 0));\r\n  }\r\n\r\n  return new ImageData(data, imageData.width, imageData.height);\r\n}\r\n\r\n/**\r\n * 画像ファイルをCanvasに読み込み\r\n * @param file 画像ファイル\r\n * @param maxWidth 最大幅（リサイズ用）\r\n * @param maxHeight 最大高さ（リサイズ用）\r\n * @returns Canvas要素とImageData\r\n */\r\nexport function loadImageToCanvas(\r\n  file: File,\r\n  maxWidth = 4096,\r\n  maxHeight = 4096\r\n): Promise<{ canvas: HTMLCanvasElement, imageData: ImageData }> {\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image();\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    if (!ctx) {\r\n      reject(new Error('Canvas context not available'));\r\n      return;\r\n    }\r\n\r\n    img.onload = () => {\r\n      // リサイズ計算\r\n      let { width, height } = img;\r\n      if (width > maxWidth || height > maxHeight) {\r\n        const ratio = Math.min(maxWidth / width, maxHeight / height);\r\n        width *= ratio;\r\n        height *= ratio;\r\n      }\r\n\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n\r\n      // 画像を描画\r\n      ctx.drawImage(img, 0, 0, width, height);\r\n\r\n      // ImageDataを取得\r\n      const imageData = ctx.getImageData(0, 0, width, height);\r\n\r\n      resolve({ canvas, imageData });\r\n    };\r\n\r\n    img.onerror = () => {\r\n      reject(new Error('Failed to load image'));\r\n    };\r\n\r\n    img.src = URL.createObjectURL(file);\r\n  });\r\n}\r\n\r\n/**\r\n * ImageDataをCanvasに描画\r\n * @param canvas Canvas要素\r\n * @param imageData ImageData\r\n */\r\nexport function drawImageDataToCanvas(\r\n  canvas: HTMLCanvasElement,\r\n  imageData: ImageData\r\n): void {\r\n  const ctx = canvas.getContext('2d');\r\n  if (!ctx) throw new Error('Canvas context not available');\r\n\r\n  canvas.width = imageData.width;\r\n  canvas.height = imageData.height;\r\n  ctx.putImageData(imageData, 0, 0);\r\n}\r\n\r\n/**\r\n * CanvasをBlob/File形式でダウンロード\r\n * @param canvas Canvas要素\r\n * @param filename ファイル名\r\n * @param format 画像フォーマット\r\n * @param quality 品質（JPEG用）\r\n */\r\nexport function downloadCanvasAsImage(\r\n  canvas: HTMLCanvasElement,\r\n  filename = 'colorwise-processed.png',\r\n  format: 'image/png' | 'image/jpeg' | 'image/webp' = 'image/png',\r\n  quality = 0.9\r\n): void {\r\n  canvas.toBlob((blob) => {\r\n    if (!blob) return;\r\n\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = filename;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  }, format, quality);\r\n}\r\n\r\n/**\r\n * ファイルサイズを人間に読みやすい形式に変換\r\n * @param bytes バイト数\r\n * @returns フォーマットされた文字列\r\n */\r\nexport function formatFileSize(bytes: number): string {\r\n  if (bytes === 0) return '0 Bytes';\r\n\r\n  const k = 1024;\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n}\r\n\r\n/**\r\n * 画像ファイルの妥当性をチェック\r\n * @param file ファイル\r\n * @param maxSize 最大サイズ（バイト）\r\n * @returns エラーメッセージまたはnull\r\n */\r\nexport function validateImageFile(\r\n  file: File,\r\n  maxSize = 10 * 1024 * 1024 // 10MB\r\n): string | null {\r\n  // ファイルタイプチェック\r\n  if (!file.type.startsWith('image/')) {\r\n    return '画像ファイルを選択してください';\r\n  }\r\n\r\n  // サポートされている形式チェック\r\n  const supportedTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];\r\n  if (!supportedTypes.includes(file.type)) {\r\n    return 'サポートされていない画像形式です（JPEG, PNG, WebP, GIFのみ）';\r\n  }\r\n\r\n  // ファイルサイズチェック\r\n  if (file.size > maxSize) {\r\n    return `ファイルサイズが大きすぎます（最大: ${formatFileSize(maxSize)}）`;\r\n  }\r\n\r\n  return null;\r\n}","import React, { useCallback, useState } from 'react';\r\nimport type { ImageFileInfo, ImageProcessingState } from '@/types/color';\r\nimport { validateImageFile } from '@/lib/image-processing/image-processor';\r\n\r\ninterface ImageUploaderProps {\r\n  onImageLoad: (imageInfo: ImageFileInfo) => void;\r\n  processingState: ImageProcessingState;\r\n  disabled?: boolean;\r\n}\r\n\r\n/**\r\n * 画像アップロードコンポーネント\r\n * ドラッグ&ドロップ対応\r\n */\r\nexport const ImageUploader: React.FC<ImageUploaderProps> = ({\r\n  onImageLoad,\r\n  processingState,\r\n  disabled = false\r\n}) => {\r\n  const [dragOver, setDragOver] = useState(false);\r\n\r\n  const handleFileSelect = useCallback((file: File) => {\r\n    const validationError = validateImageFile(file);\r\n    if (validationError) {\r\n      alert(validationError);\r\n      return;\r\n    }\r\n\r\n    // 画像の寸法を取得\r\n    const img = new Image();\r\n    img.onload = () => {\r\n      const imageInfo: ImageFileInfo = {\r\n        file,\r\n        url: URL.createObjectURL(file),\r\n        width: img.width,\r\n        height: img.height,\r\n        size: file.size\r\n      };\r\n      onImageLoad(imageInfo);\r\n    };\r\n    img.src = URL.createObjectURL(file);\r\n  }, [onImageLoad]);\r\n\r\n  const handleFileInput = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    if (file) {\r\n      handleFileSelect(file);\r\n    }\r\n  }, [handleFileSelect]);\r\n\r\n  const handleDrop = useCallback((event: React.DragEvent) => {\r\n    event.preventDefault();\r\n    setDragOver(false);\r\n\r\n    const file = event.dataTransfer.files[0];\r\n    if (file) {\r\n      handleFileSelect(file);\r\n    }\r\n  }, [handleFileSelect]);\r\n\r\n  const handleDragOver = useCallback((event: React.DragEvent) => {\r\n    event.preventDefault();\r\n    setDragOver(true);\r\n  }, []);\r\n\r\n  const handleDragLeave = useCallback((event: React.DragEvent) => {\r\n    event.preventDefault();\r\n    setDragOver(false);\r\n  }, []);\r\n\r\n  return (\r\n    <div style={{\r\n      background: '#FFFFFF',\r\n      borderRadius: '0.75rem',\r\n      padding: '2rem',\r\n      boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)',\r\n      width: '100%'\r\n    }}>\r\n      <h3 style={{\r\n        fontSize: '1.25rem',\r\n        fontWeight: '600',\r\n        color: '#111827',\r\n        margin: '0 0 1.5rem 0'\r\n      }}>\r\n        📸 写真をアップロード\r\n      </h3>\r\n\r\n      <div\r\n        onDrop={handleDrop}\r\n        onDragOver={handleDragOver}\r\n        onDragLeave={handleDragLeave}\r\n        style={{\r\n          border: dragOver\r\n            ? '2px dashed #3B82F6'\r\n            : '2px dashed #D1D5DB',\r\n          borderRadius: '0.5rem',\r\n          padding: '3rem 1rem',\r\n          textAlign: 'center',\r\n          transition: 'all 0.2s ease',\r\n          background: dragOver ? '#F0F9FF' : '#F9FAFB',\r\n          cursor: disabled ? 'not-allowed' : 'pointer',\r\n          opacity: disabled ? 0.5 : 1\r\n        }}\r\n      >\r\n        {processingState.isProcessing ? (\r\n          <div>\r\n            <div style={{\r\n              width: '48px',\r\n              height: '48px',\r\n              border: '4px solid #E5E7EB',\r\n              borderTop: '4px solid #3B82F6',\r\n              borderRadius: '50%',\r\n              animation: 'spin 1s linear infinite',\r\n              margin: '0 auto 1rem'\r\n            }} />\r\n            <p style={{\r\n              color: '#6B7280',\r\n              fontSize: '1rem',\r\n              margin: '0 0 0.5rem 0'\r\n            }}>\r\n              処理中... {processingState.progress}%\r\n            </p>\r\n            <div style={{\r\n              width: '100%',\r\n              height: '8px',\r\n              background: '#E5E7EB',\r\n              borderRadius: '4px',\r\n              overflow: 'hidden',\r\n              margin: '0 auto',\r\n              maxWidth: '200px'\r\n            }}>\r\n              <div style={{\r\n                width: `${processingState.progress}%`,\r\n                height: '100%',\r\n                background: '#3B82F6',\r\n                transition: 'width 0.3s ease'\r\n              }} />\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            <div style={{\r\n              fontSize: '3rem',\r\n              marginBottom: '1rem'\r\n            }}>\r\n              📷\r\n            </div>\r\n            <p style={{\r\n              color: '#374151',\r\n              fontSize: '1.125rem',\r\n              fontWeight: '500',\r\n              margin: '0 0 0.5rem 0'\r\n            }}>\r\n              写真をドラッグ&ドロップ\r\n            </p>\r\n            <p style={{\r\n              color: '#6B7280',\r\n              fontSize: '0.875rem',\r\n              margin: '0 0 1.5rem 0'\r\n            }}>\r\n              または下のボタンから選択\r\n            </p>\r\n\r\n            <label style={{\r\n              display: 'inline-block',\r\n              background: '#3B82F6',\r\n              color: 'white',\r\n              padding: '0.75rem 2rem',\r\n              borderRadius: '0.5rem',\r\n              fontWeight: '500',\r\n              cursor: disabled ? 'not-allowed' : 'pointer',\r\n              transition: 'background-color 0.2s ease'\r\n            }}>\r\n              ファイルを選択\r\n              <input\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={handleFileInput}\r\n                disabled={disabled}\r\n                style={{ display: 'none' }}\r\n              />\r\n            </label>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div style={{\r\n        marginTop: '1rem',\r\n        padding: '1rem',\r\n        background: '#F0F9FF',\r\n        borderRadius: '0.5rem',\r\n        border: '1px solid #BFDBFE'\r\n      }}>\r\n        <p style={{\r\n          fontSize: '0.875rem',\r\n          color: '#374151',\r\n          margin: '0',\r\n          lineHeight: '1.5'\r\n        }}>\r\n          💡 <strong>対応形式:</strong> JPEG, PNG, WebP, GIF<br />\r\n          📏 <strong>推奨サイズ:</strong> 10MB以下、1920×1080px以下\r\n        </p>\r\n      </div>\r\n\r\n      {processingState.error && (\r\n        <div style={{\r\n          marginTop: '1rem',\r\n          padding: '1rem',\r\n          background: '#FEF2F2',\r\n          borderRadius: '0.5rem',\r\n          border: '1px solid #FECACA'\r\n        }}>\r\n          <p style={{\r\n            fontSize: '0.875rem',\r\n            color: '#DC2626',\r\n            margin: '0',\r\n            fontWeight: '500'\r\n          }}>\r\n            ❌ エラー: {processingState.error}\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      <style>\r\n        {`\r\n            @keyframes spin {\r\n              0% { transform: rotate(0deg); }\r\n              100% { transform: rotate(360deg); }\r\n            }\r\n          `}\r\n      </style>\r\n    </div>\r\n  );\r\n};","import React, { useState, useEffect, useRef } from 'react';\r\nimport type { ImageFileInfo, ColorVisionSettings } from '@/types/color';\r\nimport {\r\n  loadImageToCanvas,\r\n  drawImageDataToCanvas,\r\n  downloadCanvasAsImage,\r\n  processImageData,\r\n  formatFileSize\r\n} from '@/lib/image-processing/image-processor';\r\n\r\ninterface ImageViewerProps {\r\n  imageInfo: ImageFileInfo | null;\r\n  colorVisionSettings: ColorVisionSettings;\r\n  onProcessingStateChange: (isProcessing: boolean, progress: number, error?: string) => void;\r\n}\r\n\r\ntype ViewMode = 'original' | 'processed' | 'split';\r\n\r\n/**\r\n * 画像表示・処理コンポーネント\r\n */\r\nexport const ImageViewer: React.FC<ImageViewerProps> = ({\r\n  imageInfo,\r\n  colorVisionSettings,\r\n  onProcessingStateChange\r\n}) => {\r\n  const originalCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const processedCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const [viewMode, setViewMode] = useState<ViewMode>('processed');\r\n  const [originalImageData, setOriginalImageData] = useState<ImageData | null>(null);\r\n  const [processedImageData, setProcessedImageData] = useState<ImageData | null>(null);\r\n\r\n  // 画像読み込み\r\n  useEffect(() => {\r\n    if (!imageInfo) {\r\n      setOriginalImageData(null);\r\n      setProcessedImageData(null);\r\n      return;\r\n    }\r\n\r\n    const loadImage = async () => {\r\n      try {\r\n        onProcessingStateChange(true, 0);\r\n\r\n        const { imageData } = await loadImageToCanvas(imageInfo.file);\r\n        setOriginalImageData(imageData);\r\n\r\n        // オリジナル画像をcanvasに描画\r\n        if (originalCanvasRef.current) {\r\n          drawImageDataToCanvas(originalCanvasRef.current, imageData);\r\n        }\r\n\r\n        // 画像読み込み完了時は processing状態を継続（色覚処理待ち）\r\n      } catch (error) {\r\n        onProcessingStateChange(false, 0, '画像の読み込みに失敗しました');\r\n      }\r\n    };\r\n\r\n    loadImage();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [imageInfo]); // onProcessingStateChangeは親コンポーネントで安定化すべき\r\n\r\n  // 色覚設定変更時の再処理\r\n  useEffect(() => {\r\n    if (!originalImageData) return;\r\n\r\n    // 処理を遅延させて連続実行を防ぐ\r\n    const timeoutId = setTimeout(() => {\r\n      const processImage = async () => {\r\n        try {\r\n          onProcessingStateChange(true, 0);\r\n\r\n          const processed = await processImageData(\r\n            originalImageData,\r\n            colorVisionSettings,\r\n            (progress) => {\r\n              onProcessingStateChange(true, progress);\r\n            }\r\n          );\r\n\r\n          setProcessedImageData(processed);\r\n\r\n          // 処理済み画像をcanvasに描画\r\n          if (processedCanvasRef.current) {\r\n            drawImageDataToCanvas(processedCanvasRef.current, processed);\r\n          }\r\n\r\n          onProcessingStateChange(false, 100);\r\n        } catch (error) {\r\n          onProcessingStateChange(false, 0, '画像処理に失敗しました');\r\n        }\r\n      };\r\n\r\n      processImage();\r\n    }, 100); // 100ms遅延\r\n\r\n    return () => clearTimeout(timeoutId);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [originalImageData, colorVisionSettings]); // onProcessingStateChangeは親コンポーネントで安定化すべき\r\n\r\n  const handleDownload = () => {\r\n    if (!processedCanvasRef.current || !processedImageData) return;\r\n\r\n    const filename = `colorwise-${imageInfo?.file.name || 'processed'}.png`;\r\n    downloadCanvasAsImage(processedCanvasRef.current, filename);\r\n  };\r\n\r\n  if (!imageInfo) {\r\n    return (\r\n      <div style={{\r\n        background: '#F9FAFB',\r\n        borderRadius: '0.75rem',\r\n        padding: '3rem',\r\n        textAlign: 'center',\r\n        border: '2px dashed #D1D5DB'\r\n      }}>\r\n        <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>🖼️</div>\r\n        <p style={{\r\n          color: '#6B7280',\r\n          fontSize: '1.125rem',\r\n          margin: '0'\r\n        }}>\r\n          画像を選択してください\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{\r\n      background: '#FFFFFF',\r\n      borderRadius: '0.75rem',\r\n      padding: '1.5rem',\r\n      boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)',\r\n      width: '100%'\r\n    }}>\r\n      <div style={{\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        marginBottom: '1.5rem',\r\n        flexWrap: 'wrap',\r\n        gap: '1rem'\r\n      }}>\r\n        <div>\r\n          <h3 style={{\r\n            fontSize: '1.25rem',\r\n            fontWeight: '600',\r\n            color: '#111827',\r\n            margin: '0 0 0.5rem 0'\r\n          }}>\r\n            🖼️ 画像プレビュー\r\n          </h3>\r\n          <p style={{\r\n            fontSize: '0.875rem',\r\n            color: '#6B7280',\r\n            margin: '0'\r\n          }}>\r\n            {imageInfo.file.name} ({imageInfo.width}×{imageInfo.height}, {formatFileSize(imageInfo.size)})\r\n          </p>\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>\r\n          <select\r\n            value={viewMode}\r\n            onChange={(e) => setViewMode(e.target.value as ViewMode)}\r\n            style={{\r\n              padding: '0.5rem',\r\n              border: '1px solid #D1D5DB',\r\n              borderRadius: '0.375rem',\r\n              fontSize: '0.875rem'\r\n            }}\r\n          >\r\n            <option value=\"original\">元画像</option>\r\n            <option value=\"processed\">変換済み</option>\r\n            <option value=\"split\">分割表示</option>\r\n          </select>\r\n\r\n          <button\r\n            onClick={handleDownload}\r\n            disabled={!processedImageData}\r\n            style={{\r\n              background: processedImageData ? '#10B981' : '#D1D5DB',\r\n              color: 'white',\r\n              padding: '0.5rem 1rem',\r\n              borderRadius: '0.375rem',\r\n              fontWeight: '500',\r\n              border: 'none',\r\n              cursor: processedImageData ? 'pointer' : 'not-allowed',\r\n              fontSize: '0.875rem'\r\n            }}\r\n          >\r\n            💾 ダウンロード\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{\r\n        borderRadius: '0.5rem',\r\n        overflow: 'auto',\r\n        background: '#F3F4F6',\r\n        position: 'relative',\r\n        maxHeight: '80vh'\r\n      }}>\r\n        {viewMode === 'split' && (\r\n          <div style={{ display: 'flex', gap: '4px', justifyContent: 'center' }}>\r\n            <div style={{ position: 'relative' }}>\r\n              <canvas\r\n                ref={originalCanvasRef}\r\n                style={{\r\n                  maxWidth: '100%',\r\n                  height: 'auto',\r\n                  display: 'block'\r\n                }}\r\n              />\r\n              <div style={{\r\n                position: 'absolute',\r\n                top: '0.5rem',\r\n                left: '0.5rem',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: 'white',\r\n                padding: '0.25rem 0.5rem',\r\n                borderRadius: '0.25rem',\r\n                fontSize: '0.75rem',\r\n                fontWeight: '500'\r\n              }}>\r\n                元画像\r\n              </div>\r\n            </div>\r\n            <div style={{ position: 'relative' }}>\r\n              <canvas\r\n                ref={processedCanvasRef}\r\n                style={{\r\n                  maxWidth: '100%',\r\n                  height: 'auto',\r\n                  display: 'block'\r\n                }}\r\n              />\r\n              <div style={{\r\n                position: 'absolute',\r\n                top: '0.5rem',\r\n                left: '0.5rem',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: 'white',\r\n                padding: '0.25rem 0.5rem',\r\n                borderRadius: '0.25rem',\r\n                fontSize: '0.75rem',\r\n                fontWeight: '500'\r\n              }}>\r\n                変換後\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <canvas\r\n          ref={originalCanvasRef}\r\n          style={{\r\n            maxWidth: '100%',\r\n            height: 'auto',\r\n            display: viewMode === 'original' ? 'block' : 'none',\r\n            margin: '0 auto'\r\n          }}\r\n        />\r\n\r\n        <canvas\r\n          ref={processedCanvasRef}\r\n          style={{\r\n            maxWidth: '100%',\r\n            height: 'auto',\r\n            display: viewMode === 'processed' ? 'block' : 'none',\r\n            margin: '0 auto'\r\n          }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};","import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport type { CameraConfig, ColorVisionSettings } from '@/types/color';\r\nimport {\r\n  processImageData,\r\n  drawImageDataToCanvas,\r\n  downloadCanvasAsImage\r\n} from '@/lib/image-processing/image-processor';\r\n\r\ninterface CameraCaptureProps {\r\n  colorVisionSettings: ColorVisionSettings;\r\n  onProcessingStateChange: (isProcessing: boolean, progress: number, error?: string) => void;\r\n}\r\n\r\n/**\r\n * カメラキャプチャ・リアルタイム処理コンポーネント\r\n */\r\nexport const CameraCapture: React.FC<CameraCaptureProps> = ({\r\n  colorVisionSettings,\r\n  onProcessingStateChange\r\n}) => {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const originalCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const processedCanvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n  const [cameraConfig, setCameraConfig] = useState<CameraConfig>({\r\n    isActive: false,\r\n    facingMode: 'environment',\r\n    resolution: { width: 1280, height: 720 }\r\n  });\r\n\r\n  const [devices, setDevices] = useState<MediaDeviceInfo[]>([]);\r\n  const [stream, setStream] = useState<MediaStream | null>(null);\r\n  const [isProcessingFrame, setIsProcessingFrame] = useState(false);\r\n  const [viewMode, setViewMode] = useState<'original' | 'processed' | 'split'>('processed');\r\n\r\n  // カメラデバイス一覧を取得\r\n  useEffect(() => {\r\n    const getDevices = async () => {\r\n      try {\r\n        const deviceList = await navigator.mediaDevices.enumerateDevices();\r\n        const videoDevices = deviceList.filter(device => device.kind === 'videoinput');\r\n        setDevices(videoDevices);\r\n      } catch (error) {\r\n        console.error('デバイス取得エラー:', error);\r\n      }\r\n    };\r\n\r\n    getDevices();\r\n  }, []);\r\n\r\n  // カメラストリーム開始/停止\r\n  const toggleCamera = useCallback(async () => {\r\n    if (cameraConfig.isActive && stream) {\r\n      // カメラ停止\r\n      stream.getTracks().forEach(track => track.stop());\r\n      setStream(null);\r\n      setCameraConfig(prev => ({ ...prev, isActive: false }));\r\n      return;\r\n    }\r\n\r\n    // getUserMedia対応チェック\r\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n      onProcessingStateChange(false, 0, 'お使いのブラウザはカメラアクセスに対応していません');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      onProcessingStateChange(true, 0, '');\r\n\r\n      // シンプルな設定でまず試す\r\n      const constraints = {\r\n        video: cameraConfig.deviceId\r\n          ? { deviceId: { exact: cameraConfig.deviceId } }\r\n          : { facingMode: cameraConfig.facingMode }\r\n      };\r\n\r\n      const mediaStream = await navigator.mediaDevices.getUserMedia(constraints);\r\n\r\n      setStream(mediaStream);\r\n      setCameraConfig(prev => ({ ...prev, isActive: true }));\r\n\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = mediaStream;\r\n\r\n        // video要素の準備完了を待つ\r\n        videoRef.current.onloadedmetadata = () => {\r\n          onProcessingStateChange(false, 100, '');\r\n        };\r\n      }\r\n    } catch (error) {\r\n      let errorMessage = 'カメラにアクセスできませんでした';\r\n      if (error instanceof Error) {\r\n        if (error.name === 'NotAllowedError') {\r\n          errorMessage = 'カメラアクセスが拒否されました。ブラウザの設定を確認してください';\r\n        } else if (error.name === 'NotFoundError') {\r\n          errorMessage = 'カメラが見つかりませんでした';\r\n        } else if (error.name === 'NotReadableError') {\r\n          errorMessage = 'カメラが他のアプリケーションで使用中です';\r\n        } else {\r\n          errorMessage = `カメラエラー: ${error.message}`;\r\n        }\r\n      }\r\n\r\n      onProcessingStateChange(false, 0, errorMessage);\r\n    }\r\n  }, [cameraConfig, stream, onProcessingStateChange]);\r\n\r\n  // 静止画キャプチャ・処理\r\n  const captureAndProcess = useCallback(async () => {\r\n    if (!videoRef.current || !originalCanvasRef.current || !processedCanvasRef.current) return;\r\n    if (isProcessingFrame) return;\r\n\r\n    const video = videoRef.current;\r\n    const originalCanvas = originalCanvasRef.current;\r\n    const processedCanvas = processedCanvasRef.current;\r\n\r\n    // ビデオフレームをcanvasに描画\r\n    originalCanvas.width = video.videoWidth;\r\n    originalCanvas.height = video.videoHeight;\r\n    processedCanvas.width = video.videoWidth;\r\n    processedCanvas.height = video.videoHeight;\r\n\r\n    const ctx = originalCanvas.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    ctx.drawImage(video, 0, 0);\r\n    const imageData = ctx.getImageData(0, 0, originalCanvas.width, originalCanvas.height);\r\n\r\n    setIsProcessingFrame(true);\r\n    onProcessingStateChange(true, 50, '画像を処理中...');\r\n\r\n    try {\r\n      // 色変換処理を適用\r\n      const processedImageData = await processImageData(imageData, colorVisionSettings);\r\n      drawImageDataToCanvas(processedCanvas, processedImageData);\r\n      onProcessingStateChange(false, 100, '処理完了');\r\n    } catch (error) {\r\n      console.error('フレーム処理エラー:', error);\r\n      onProcessingStateChange(false, 0, '処理中にエラーが発生しました');\r\n    } finally {\r\n      setIsProcessingFrame(false);\r\n    }\r\n  }, [colorVisionSettings, isProcessingFrame, onProcessingStateChange]);\r\n\r\n  // キャプチャ機能\r\n  const capturePhoto = useCallback(() => {\r\n    if (!processedCanvasRef.current) return;\r\n\r\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n    const filename = `colorwise-capture-${timestamp}.png`;\r\n    downloadCanvasAsImage(processedCanvasRef.current, filename);\r\n  }, []);\r\n\r\n  return (\r\n    <div style={{\r\n      background: '#FFFFFF',\r\n      borderRadius: '0.75rem',\r\n      padding: '1.5rem',\r\n      boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)',\r\n      width: '100%'\r\n    }}>\r\n      <div style={{\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        marginBottom: '1.5rem',\r\n        flexWrap: 'wrap',\r\n        gap: '1rem'\r\n      }}>\r\n        <h3 style={{\r\n          fontSize: '1.25rem',\r\n          fontWeight: '600',\r\n          color: '#111827',\r\n          margin: '0'\r\n        }}>\r\n          📷 カメラキャプチャ\r\n        </h3>\r\n\r\n        <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>\r\n          {devices.length > 1 && (\r\n            <select\r\n              value={cameraConfig.deviceId || ''}\r\n              onChange={(e) => setCameraConfig(prev => ({ ...prev, deviceId: e.target.value }))}\r\n              disabled={cameraConfig.isActive}\r\n              style={{\r\n                padding: '0.5rem',\r\n                border: '1px solid #D1D5DB',\r\n                borderRadius: '0.375rem',\r\n                fontSize: '0.875rem'\r\n              }}\r\n            >\r\n              <option value=\"\">デフォルト</option>\r\n              {devices.map(device => (\r\n                <option key={device.deviceId} value={device.deviceId}>\r\n                  {device.label || `カメラ ${device.deviceId.slice(0, 8)}`}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          )}\r\n\r\n          <select\r\n            value={viewMode}\r\n            onChange={(e) => setViewMode(e.target.value as 'original' | 'processed' | 'split')}\r\n            style={{\r\n              padding: '0.5rem',\r\n              border: '1px solid #D1D5DB',\r\n              borderRadius: '0.375rem',\r\n              fontSize: '0.875rem'\r\n            }}\r\n          >\r\n            <option value=\"original\">元画像</option>\r\n            <option value=\"processed\">変換済み</option>\r\n            <option value=\"split\">分割表示</option>\r\n          </select>\r\n\r\n          <button\r\n            onClick={toggleCamera}\r\n            style={{\r\n              background: cameraConfig.isActive ? '#DC2626' : '#10B981',\r\n              color: 'white',\r\n              padding: '0.5rem 1rem',\r\n              borderRadius: '0.375rem',\r\n              fontWeight: '500',\r\n              border: 'none',\r\n              cursor: 'pointer',\r\n              fontSize: '0.875rem'\r\n            }}\r\n          >\r\n            {cameraConfig.isActive ? '⏹️ 停止' : '📹 カメラを起動'}\r\n          </button>\r\n\r\n          {cameraConfig.isActive && (\r\n            <>\r\n              <button\r\n                onClick={captureAndProcess}\r\n                disabled={isProcessingFrame}\r\n                style={{\r\n                  background: isProcessingFrame ? '#9CA3AF' : '#059669',\r\n                  color: 'white',\r\n                  padding: '0.5rem 1rem',\r\n                  borderRadius: '0.375rem',\r\n                  fontWeight: '500',\r\n                  border: 'none',\r\n                  cursor: isProcessingFrame ? 'not-allowed' : 'pointer',\r\n                  fontSize: '0.875rem'\r\n                }}\r\n              >\r\n                {isProcessingFrame ? '🔄 処理中...' : '📸 撮影'}\r\n              </button>\r\n\r\n              <button\r\n                onClick={capturePhoto}\r\n                disabled={!processedCanvasRef.current}\r\n                style={{\r\n                  background: '#3B82F6',\r\n                  color: 'white',\r\n                  padding: '0.5rem 1rem',\r\n                  borderRadius: '0.375rem',\r\n                  fontWeight: '500',\r\n                  border: 'none',\r\n                  cursor: 'pointer',\r\n                  fontSize: '0.875rem'\r\n                }}\r\n              >\r\n                💾 保存\r\n              </button>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{\r\n        borderRadius: '0.5rem',\r\n        overflow: 'auto',\r\n        background: '#F3F4F6',\r\n        position: 'relative',\r\n        minHeight: '400px',\r\n        maxHeight: '80vh'\r\n      }}>\r\n        {!cameraConfig.isActive ? (\r\n          <div style={{\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            height: '300px',\r\n            flexDirection: 'column',\r\n            gap: '1rem'\r\n          }}>\r\n            <div style={{ fontSize: '3rem' }}>📹</div>\r\n            <p style={{\r\n              color: '#6B7280',\r\n              fontSize: '1.125rem',\r\n              margin: '0'\r\n            }}>\r\n              カメラを起動してください\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            <video\r\n              ref={videoRef}\r\n              autoPlay\r\n              playsInline\r\n              muted\r\n              style={{\r\n                display: 'none'\r\n              }}\r\n            />\r\n\r\n            {viewMode === 'split' && (\r\n              <div style={{ display: 'flex', gap: '4px', justifyContent: 'center' }}>\r\n                <div style={{ position: 'relative' }}>\r\n                  <canvas\r\n                    ref={originalCanvasRef}\r\n                    style={{\r\n                      maxWidth: '100%',\r\n                      height: 'auto',\r\n                      display: 'block'\r\n                    }}\r\n                  />\r\n                  <div style={{\r\n                    position: 'absolute',\r\n                    top: '0.5rem',\r\n                    left: '0.5rem',\r\n                    background: 'rgba(0,0,0,0.7)',\r\n                    color: 'white',\r\n                    padding: '0.25rem 0.5rem',\r\n                    borderRadius: '0.25rem',\r\n                    fontSize: '0.75rem',\r\n                    fontWeight: '500'\r\n                  }}>\r\n                    オリジナル\r\n                  </div>\r\n                </div>\r\n                <div style={{ position: 'relative' }}>\r\n                  <canvas\r\n                    ref={processedCanvasRef}\r\n                    style={{\r\n                      maxWidth: '100%',\r\n                      height: 'auto',\r\n                      display: 'block'\r\n                    }}\r\n                  />\r\n                  <div style={{\r\n                    position: 'absolute',\r\n                    top: '0.5rem',\r\n                    left: '0.5rem',\r\n                    background: 'rgba(0,0,0,0.7)',\r\n                    color: 'white',\r\n                    padding: '0.25rem 0.5rem',\r\n                    borderRadius: '0.25rem',\r\n                    fontSize: '0.75rem',\r\n                    fontWeight: '500'\r\n                  }}>\r\n                    変換後\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <canvas\r\n              ref={originalCanvasRef}\r\n              style={{\r\n                maxWidth: '100%',\r\n                height: 'auto',\r\n                display: viewMode === 'original' ? 'block' : 'none',\r\n                margin: '0 auto'\r\n              }}\r\n            />\r\n\r\n            <canvas\r\n              ref={processedCanvasRef}\r\n              style={{\r\n                maxWidth: '100%',\r\n                height: 'auto',\r\n                display: viewMode === 'processed' ? 'block' : 'none',\r\n                margin: '0 auto'\r\n              }}\r\n            />\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};","import React, { useRef, useEffect, useState, useCallback, useMemo } from 'react';\r\nimport { oklabToRgb, isInGamut } from '@lib/color-science/oklab';\r\nimport { ColorVisionSettings } from '@/types/color';\r\nimport { createDeutanSimulator, createDeutanCorrector } from '@features/color-simulation/utils/deutan-simulator';\r\n\r\ninterface Point3D {\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n}\r\n\r\ninterface ColorPoint extends Point3D {\r\n    color: string;\r\n    originalRgb: [number, number, number];\r\n    size: number;\r\n}\r\n\r\ninterface TransformedPoint {\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    scale: number;\r\n    color: string;\r\n    size: number;\r\n}\r\n\r\nexport const ColorVolumeViewer3D: React.FC<{ settings: ColorVisionSettings }> = ({ settings }) => {\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const [angleX, setAngleX] = useState(0.5);\r\n    const [angleY, setAngleY] = useState(0.5);\r\n    const [zoom, setZoom] = useState(600);\r\n    const [autoRotate, setAutoRotate] = useState(true);\r\n\r\n    // Generate color points based on Oklab space\r\n    const points = useMemo(() => {\r\n        const pts: ColorPoint[] = [];\r\n\r\n        // L axis (Vertical)\r\n        for (let L = 0; L <= 1; L += 0.05) {\r\n            // Circle sampling for each L layer\r\n            for (let angle = 0; angle < Math.PI * 2; angle += Math.PI / 18) {\r\n                // Chroma axis: sample outwards until gamut boundary\r\n                // We use a safe maximum for Oklab chromatography\r\n                for (let C = 0; C <= 0.4; C += 0.02) {\r\n                    const a = C * Math.cos(angle);\r\n                    const b = C * Math.sin(angle);\r\n\r\n                    if (isInGamut(L, a, b)) {\r\n                        const rgb = oklabToRgb(L, a, b);\r\n\r\n                        // Filter out obviously wrong black points for high L\r\n                        const isBlackish = rgb.r < 10 && rgb.g < 10 && rgb.b < 10;\r\n                        if (isBlackish && L > 0.2) continue;\r\n\r\n                        const size = C > 0.2 ? 2.5 : C > 0.1 ? 2 : 1.5;\r\n                        pts.push({\r\n                            x: a,\r\n                            y: L - 0.5, // Center the volume vertically\r\n                            z: b,\r\n                            color: `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`,\r\n                            originalRgb: [rgb.r, rgb.g, rgb.b],\r\n                            size,\r\n                        });\r\n                    } else {\r\n                        // Once we hit the gamut boundary for this angle, we can stop for this hue\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Gray axis (Central column)\r\n        for (let L = 0; L <= 1; L += 0.01) {\r\n            const rgb = oklabToRgb(L, 0, 0);\r\n            pts.push({\r\n                x: 0,\r\n                y: L - 0.5,\r\n                z: 0,\r\n                color: `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`,\r\n                originalRgb: [rgb.r, rgb.g, rgb.b],\r\n                size: 3,\r\n            });\r\n        }\r\n\r\n        return pts;\r\n    }, []);\r\n\r\n    // Apply color vision settings to points\r\n    const processedPoints = useMemo(() => {\r\n        const isDeutanSimulation = settings.simulation.useSimulation && settings.simulation.simulationType === 'deuteranopia';\r\n        const isDeutanCorrection = settings.correction.useCorrection && settings.correction.correctionType === 'deuteranopia';\r\n\r\n        if (!isDeutanSimulation && !isDeutanCorrection) {\r\n            return points.map(p => ({ ...p, color: `rgb(${p.originalRgb[0]}, ${p.originalRgb[1]}, ${p.originalRgb[2]})` }));\r\n        }\r\n\r\n        // Pre-calculate processors (expensive matrix eval happens here ONCE)\r\n        const simulate = isDeutanSimulation ? createDeutanSimulator(settings.simulation.severity) : null;\r\n        const correct = isDeutanCorrection ? createDeutanCorrector(settings.correction.strength, settings.correction.headroom) : null;\r\n\r\n        return points.map(p => {\r\n            let rgb = p.originalRgb;\r\n\r\n            if (correct) {\r\n                rgb = correct(rgb);\r\n            }\r\n\r\n            if (simulate) {\r\n                rgb = simulate(rgb);\r\n            }\r\n\r\n            return {\r\n                ...p,\r\n                color: `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`\r\n            };\r\n        });\r\n    }, [points, settings.simulation.useSimulation, settings.simulation.simulationType, settings.simulation.severity, settings.correction.useCorrection, settings.correction.correctionType, settings.correction.strength, settings.correction.headroom]);\r\n\r\n    // 3D rotation helpers\r\n    const rotateX = (p: Point3D, angle: number): Point3D => {\r\n        const cos = Math.cos(angle), sin = Math.sin(angle);\r\n        return {\r\n            x: p.x,\r\n            y: p.y * cos - p.z * sin,\r\n            z: p.y * sin + p.z * cos\r\n        };\r\n    };\r\n\r\n    const rotateY = (p: Point3D, angle: number): Point3D => {\r\n        const cos = Math.cos(angle), sin = Math.sin(angle);\r\n        return {\r\n            x: p.x * cos + p.z * sin,\r\n            y: p.y,\r\n            z: -p.x * sin + p.z * cos\r\n        };\r\n    };\r\n\r\n    const project = (p: Point3D, width: number, height: number, zScale: number): { x: number; y: number; scale: number } => {\r\n        const scale = zScale / (2 + p.z);\r\n        return {\r\n            x: width / 2 + p.x * scale,\r\n            y: height / 2 - p.y * scale,\r\n            scale\r\n        };\r\n    };\r\n\r\n    const render = useCallback(() => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas) return;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        const width = canvas.width;\r\n        const height = canvas.height;\r\n\r\n        ctx.fillStyle = '#0f172a'; // Dark slate background\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        // Transform and sort points by depth\r\n        const transformed: TransformedPoint[] = processedPoints.map(p => {\r\n            let pt = { x: p.x, y: p.y, z: p.z };\r\n            pt = rotateY(pt, angleY);\r\n            pt = rotateX(pt, angleX);\r\n\r\n            const proj = project(pt, width, height, zoom);\r\n            return {\r\n                x: proj.x,\r\n                y: proj.y,\r\n                z: pt.z,\r\n                scale: proj.scale,\r\n                color: p.color,\r\n                size: p.size\r\n            };\r\n        }).sort((a, b) => a.z - b.z);\r\n\r\n        // Render points\r\n        transformed.forEach(p => {\r\n            if (p.x >= 0 && p.x <= width && p.y >= 0 && p.y <= height) {\r\n                ctx.fillStyle = p.color;\r\n                ctx.beginPath();\r\n                const radius = p.size * (p.scale / zoom) * 2;\r\n                ctx.arc(p.x, p.y, Math.max(0.5, radius), 0, Math.PI * 2);\r\n                ctx.fill();\r\n            }\r\n        });\r\n\r\n        if (autoRotate) {\r\n            setAngleY(prev => prev + 0.005);\r\n        }\r\n    }, [processedPoints, angleX, angleY, zoom, autoRotate]);\r\n\r\n    useEffect(() => {\r\n        const frameId = requestAnimationFrame(render);\r\n        return () => cancelAnimationFrame(frameId);\r\n    }, [render]);\r\n\r\n    // Mouse interactivity\r\n    const isDragging = useRef(false);\r\n    const lastMousePos = useRef({ x: 0, y: 0 });\r\n\r\n    const handleMouseDown = (e: React.MouseEvent) => {\r\n        isDragging.current = true;\r\n        lastMousePos.current = { x: e.clientX, y: e.clientY };\r\n        setAutoRotate(false);\r\n    };\r\n\r\n    const handleMouseMove = (e: React.MouseEvent) => {\r\n        if (isDragging.current) {\r\n            const dx = e.clientX - lastMousePos.current.x;\r\n            const dy = e.clientY - lastMousePos.current.y;\r\n            setAngleY(prev => prev + dx * 0.01);\r\n            setAngleX(prev => prev + dy * 0.01);\r\n            lastMousePos.current = { x: e.clientX, y: e.clientY };\r\n        }\r\n    };\r\n\r\n    const handleMouseUp = () => {\r\n        isDragging.current = false;\r\n    };\r\n\r\n    const handleWheel = (e: React.WheelEvent) => {\r\n        setZoom(prev => {\r\n            const next = prev - e.deltaY * 0.5;\r\n            return Math.max(200, Math.min(1500, next));\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div style={{\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            alignItems: 'center',\r\n            gap: '1.5rem',\r\n            width: '100%'\r\n        }}>\r\n            <div style={{\r\n                position: 'relative',\r\n                width: '100%',\r\n                maxWidth: '600px',\r\n                aspectRatio: '1/1',\r\n                background: '#0f172a',\r\n                borderRadius: '1.5rem',\r\n                overflow: 'hidden',\r\n                boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.5)',\r\n                cursor: isDragging.current ? 'grabbing' : 'grab'\r\n            }}>\r\n                <canvas\r\n                    ref={canvasRef}\r\n                    width={600}\r\n                    height={600}\r\n                    onMouseDown={handleMouseDown}\r\n                    onMouseMove={handleMouseMove}\r\n                    onMouseUp={handleMouseUp}\r\n                    onMouseLeave={handleMouseUp}\r\n                    onWheel={handleWheel}\r\n                    onDoubleClick={() => {\r\n                        setAngleX(0.5);\r\n                        setAngleY(0.5);\r\n                        setZoom(600);\r\n                    }}\r\n                    style={{ width: '100%', height: '100%' }}\r\n                />\r\n\r\n                <div style={{\r\n                    position: 'absolute',\r\n                    bottom: '1rem',\r\n                    right: '1rem',\r\n                    display: 'flex',\r\n                    gap: '0.5rem'\r\n                }}>\r\n                    <button\r\n                        onClick={() => setAutoRotate(!autoRotate)}\r\n                        style={{\r\n                            padding: '0.5rem 1rem',\r\n                            borderRadius: '9999px',\r\n                            border: 'none',\r\n                            background: autoRotate ? '#3b82f6' : '#475569',\r\n                            color: 'white',\r\n                            fontSize: '0.75rem',\r\n                            fontWeight: '600',\r\n                            cursor: 'pointer'\r\n                        }}\r\n                    >\r\n                        {autoRotate ? '自動回転: ON' : '自動回転: OFF'}\r\n                    </button>\r\n                    <button\r\n                        onClick={() => {\r\n                            setAngleX(0.5);\r\n                            setAngleY(0.5);\r\n                            setZoom(600);\r\n                        }}\r\n                        style={{\r\n                            padding: '0.5rem 1rem',\r\n                            borderRadius: '9999px',\r\n                            border: 'none',\r\n                            background: '#475569',\r\n                            color: 'white',\r\n                            fontSize: '0.75rem',\r\n                            fontWeight: '600',\r\n                            cursor: 'pointer'\r\n                        }}\r\n                    >\r\n                        リセット\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            <div style={{\r\n                fontSize: '0.875rem',\r\n                color: '#64748b',\r\n                textAlign: 'center',\r\n                padding: '0 1rem'\r\n            }}>\r\n                🖱️ ドラッグで回転 | スクロールでズーム | ダブルクリックでリセット\r\n                <br />\r\n                <span style={{ fontSize: '0.75rem', opacity: 0.8 }}>\r\n                    Oklab空間におけるsRGBガモットの形状を可視化しています。\r\n                </span>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React from 'react';\r\n\r\ninterface AboutModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  activeSection: 'about' | 'credits' | 'privacy' | 'disclaimer';\r\n}\r\n\r\nexport const AboutModal: React.FC<AboutModalProps> = ({ isOpen, onClose, activeSection }) => {\r\n  if (!isOpen) return null;\r\n\r\n  const renderContent = () => {\r\n    switch (activeSection) {\r\n      case 'about':\r\n        return (\r\n          <div>\r\n            <h2 style={{ color: '#111827', marginBottom: '1rem' }}>このアプリについて</h2>\r\n            <div style={{ lineHeight: '1.6', color: '#374151' }}>\r\n              <p><strong>ColorWise（カラーワイズ）</strong>は、色覚の多様性に配慮した色表示支援ツールです。</p>\r\n              \r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>🎯 目的</h3>\r\n              <ul style={{ paddingLeft: '1.5rem' }}>\r\n                <li>色覚の違いによる見え方の体験・理解促進</li>\r\n                <li>デジタルコンテンツの色調整支援</li>\r\n                <li>より包括的なデザイン環境の実現</li>\r\n              </ul>\r\n\r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>⚠️ 重要な注意</h3>\r\n              <ul style={{ paddingLeft: '1.5rem' }}>\r\n                <li>本アプリは医療機器ではありません</li>\r\n                <li>色覚異常の診断・治療を目的としていません</li>\r\n                <li>医師の診断に代わるものではありません</li>\r\n              </ul>\r\n\r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>🔒 プライバシー</h3>\r\n              <ul style={{ paddingLeft: '1.5rem' }}>\r\n                <li>すべての処理は端末内で完結</li>\r\n                <li>画像データの外部送信なし</li>\r\n                <li>個人情報の収集なし</li>\r\n              </ul>\r\n\r\n              <div style={{\r\n                marginTop: '2rem',\r\n                paddingTop: '1rem',\r\n                borderTop: '1px solid #E5E7EB',\r\n                fontSize: '0.75rem',\r\n                color: '#6B7280'\r\n              }}>\r\n                <p style={{ margin: 0 }}>\r\n                  <strong>Version:</strong> {import.meta.env.VITE_APP_VERSION || '3.0.1'}\r\n                  {import.meta.env.VITE_BUILD_TIME && (\r\n                    <span> (Built: {new Date(import.meta.env.VITE_BUILD_TIME).toLocaleString('ja-JP')})</span>\r\n                  )}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        );\r\n      \r\n      case 'credits':\r\n        return (\r\n          <div>\r\n            <h2 style={{ color: '#111827', marginBottom: '1rem' }}>クレジット・謝辞</h2>\r\n            <div style={{ lineHeight: '1.6', color: '#374151' }}>\r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>🎓 学術的基盤</h3>\r\n              <p>本アプリの色覚シミュレーション機能は、以下の研究成果を参考に実装されています：</p>\r\n              <div style={{ \r\n                background: '#F9FAFB', \r\n                padding: '1rem', \r\n                borderRadius: '0.5rem', \r\n                border: '1px solid #E5E7EB',\r\n                marginTop: '0.5rem'\r\n              }}>\r\n                <p style={{ fontWeight: 'bold', margin: '0 0 0.5rem 0' }}>\r\n                  Machado, G.M., Oliveira, M.M., and Fernandes, L.A.F. (2009)\r\n                </p>\r\n                <p style={{ fontStyle: 'italic', margin: '0 0 0.5rem 0' }}>\r\n                  \"A Physiologically-based Model for Simulation of Color Vision Deficiency\"\r\n                </p>\r\n                <p style={{ fontSize: '0.875rem', margin: '0' }}>\r\n                  IEEE Transactions on Visualization and Computer Graphics, Vol.15, No.6, pp.1291-1298\r\n                </p>\r\n              </div>\r\n              \r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>🛠️ 技術スタック</h3>\r\n              <ul style={{ paddingLeft: '1.5rem' }}>\r\n                <li>React 18 + TypeScript</li>\r\n                <li>Vite (ビルドツール)</li>\r\n                <li>PWA (Service Worker + Manifest)</li>\r\n                <li>Canvas API (画像処理)</li>\r\n              </ul>\r\n\r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>🙏 謝辞</h3>\r\n              <p>\r\n                色覚の多様性に関する理解促進と、より包括的な技術環境の構築に貢献してくださる\r\n                研究者・開発者・コミュニティの皆様に深く感謝いたします。\r\n              </p>\r\n\r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>☕ 開発を支援</h3>\r\n              <p style={{ marginBottom: '1rem' }}>\r\n                このアプリが役に立ちましたら、開発継続のためのご支援をいただけると大変嬉しいです（完全任意です）。\r\n              </p>\r\n              <div style={{ textAlign: 'center' }}>\r\n                <a\r\n                  href=\"https://github.com/sponsors\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                  style={{\r\n                    display: 'inline-block',\r\n                    background: '#EA4AAA',\r\n                    color: 'white',\r\n                    padding: '0.75rem 1.5rem',\r\n                    borderRadius: '0.5rem',\r\n                    textDecoration: 'none',\r\n                    fontWeight: '500',\r\n                    transition: 'background 0.2s'\r\n                  }}\r\n                >\r\n                  💝 GitHub Sponsors で支援\r\n                </a>\r\n              </div>\r\n              <p style={{ \r\n                fontSize: '0.75rem', \r\n                color: '#6B7280', \r\n                textAlign: 'center', \r\n                margin: '0.5rem 0 0 0' \r\n              }}>\r\n                ※ 機能制限はありません。すべて任意のサポートです。\r\n              </p>\r\n            </div>\r\n          </div>\r\n        );\r\n      \r\n      case 'privacy':\r\n        return (\r\n          <div>\r\n            <h2 style={{ color: '#111827', marginBottom: '1rem' }}>プライバシーポリシー</h2>\r\n            <div style={{ lineHeight: '1.6', color: '#374151' }}>\r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>🔒 データ収集について</h3>\r\n              <p><strong>本アプリは以下のデータを一切収集しません：</strong></p>\r\n              <ul style={{ paddingLeft: '1.5rem' }}>\r\n                <li>個人識別情報</li>\r\n                <li>画像・写真データ</li>\r\n                <li>位置情報</li>\r\n                <li>閲覧履歴</li>\r\n              </ul>\r\n\r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>💾 ローカルデータ</h3>\r\n              <ul style={{ paddingLeft: '1.5rem' }}>\r\n                <li>設定情報のみをブラウザ内に保存</li>\r\n                <li>外部サーバーへの送信なし</li>\r\n                <li>ブラウザ設定から削除可能</li>\r\n              </ul>\r\n\r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>📷 カメラ機能</h3>\r\n              <ul style={{ paddingLeft: '1.5rem' }}>\r\n                <li>すべての処理が端末内で完結</li>\r\n                <li>撮影データの外部送信なし</li>\r\n                <li>アプリ終了時に自動削除</li>\r\n              </ul>\r\n\r\n              <p style={{ \r\n                background: '#EFF6FF', \r\n                padding: '1rem', \r\n                borderRadius: '0.5rem',\r\n                border: '1px solid #DBEAFE',\r\n                marginTop: '1rem'\r\n              }}>\r\n                詳細は <a href=\"/PRIVACY.md\" target=\"_blank\" rel=\"noopener noreferrer\" style={{ color: '#3B82F6' }}>\r\n                  完全版プライバシーポリシー\r\n                </a> をご確認ください。\r\n              </p>\r\n            </div>\r\n          </div>\r\n        );\r\n      \r\n      case 'disclaimer':\r\n        return (\r\n          <div>\r\n            <h2 style={{ color: '#111827', marginBottom: '1rem' }}>免責事項</h2>\r\n            <div style={{ lineHeight: '1.6', color: '#374151' }}>\r\n              <div style={{ \r\n                background: '#FEF3C7', \r\n                padding: '1rem', \r\n                borderRadius: '0.5rem',\r\n                border: '1px solid #FCD34D',\r\n                marginBottom: '1rem'\r\n              }}>\r\n                <p style={{ margin: 0, fontWeight: 'bold' }}>\r\n                  ⚠️ 重要：本アプリケーションは医療機器ではありません\r\n                </p>\r\n              </div>\r\n\r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>❌ 本アプリは以下ではありません</h3>\r\n              <ul style={{ paddingLeft: '1.5rem' }}>\r\n                <li>色覚異常の診断ツール</li>\r\n                <li>治療を目的とした製品</li>\r\n                <li>医師による診断・治療の代替手段</li>\r\n              </ul>\r\n\r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>✅ 本アプリの目的</h3>\r\n              <ul style={{ paddingLeft: '1.5rem' }}>\r\n                <li>色覚の違いによる見え方の体験・理解促進</li>\r\n                <li>デジタルコンテンツの色調整支援</li>\r\n                <li>アクセシビリティ向上のための支援</li>\r\n              </ul>\r\n\r\n              <h3 style={{ marginTop: '1.5rem', marginBottom: '0.5rem' }}>🏥 医療相談の推奨</h3>\r\n              <p>色覚に関する疑問や不安がある場合は、必ず専門の眼科医師にご相談ください。</p>\r\n\r\n              <p style={{ \r\n                background: '#FEF2F2', \r\n                padding: '1rem', \r\n                borderRadius: '0.5rem',\r\n                border: '1px solid #FECACA',\r\n                marginTop: '1rem'\r\n              }}>\r\n                詳細は <a href=\"/DISCLAIMER.md\" target=\"_blank\" rel=\"noopener noreferrer\" style={{ color: '#3B82F6' }}>\r\n                  完全版免責事項\r\n                </a> をご確認ください。\r\n              </p>\r\n            </div>\r\n          </div>\r\n        );\r\n      \r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{\r\n      position: 'fixed',\r\n      top: 0,\r\n      left: 0,\r\n      right: 0,\r\n      bottom: 0,\r\n      backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      zIndex: 1000,\r\n      padding: '1rem'\r\n    }}>\r\n      <div style={{\r\n        backgroundColor: 'white',\r\n        borderRadius: '0.75rem',\r\n        padding: '2rem',\r\n        maxWidth: '600px',\r\n        maxHeight: '80vh',\r\n        overflow: 'auto',\r\n        position: 'relative',\r\n        boxShadow: '0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04)'\r\n      }}>\r\n        <button\r\n          onClick={onClose}\r\n          style={{\r\n            position: 'absolute',\r\n            top: '1rem',\r\n            right: '1rem',\r\n            background: 'none',\r\n            border: 'none',\r\n            fontSize: '1.5rem',\r\n            cursor: 'pointer',\r\n            color: '#6B7280',\r\n            width: '2rem',\r\n            height: '2rem',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center'\r\n          }}\r\n        >\r\n          ×\r\n        </button>\r\n        \r\n        {renderContent()}\r\n      </div>\r\n    </div>\r\n  );\r\n};","import React from 'react';\r\n\r\ninterface ColorWheelIconProps {\r\n  size?: 'small' | 'medium' | 'large' | number;\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n}\r\n\r\n/**\r\n * 12色の円環アイコンコンポーネント\r\n */\r\nexport const ColorWheelIcon: React.FC<ColorWheelIconProps> = ({ \r\n  size = 'medium', \r\n  className = '', \r\n  style = {} \r\n}) => {\r\n  const getSize = () => {\r\n    if (typeof size === 'number') return size;\r\n    switch (size) {\r\n      case 'small': return 24;\r\n      case 'medium': return 32;\r\n      case 'large': return 48;\r\n      default: return 32;\r\n    }\r\n  };\r\n\r\n  const iconSize = getSize();\r\n\r\n  return (\r\n    <svg\r\n      width={iconSize}\r\n      height={iconSize}\r\n      viewBox=\"0 0 512 512\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      className={className}\r\n      style={{\r\n        ...style,\r\n        shapeRendering: 'geometricPrecision',\r\n        imageRendering: 'optimizeQuality' as React.CSSProperties['imageRendering'],\r\n        filter: 'drop-shadow(0 0 8px rgba(255, 255, 255, 0.4))'\r\n      }}\r\n    >\r\n      <defs>\r\n        {/* フレア効果フィルター */}\r\n        <filter id=\"flare\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\r\n          <feGaussianBlur stdDeviation=\"2\" result=\"coloredBlur\"/>\r\n          <feMerge>\r\n            <feMergeNode in=\"coloredBlur\"/>\r\n            <feMergeNode in=\"SourceGraphic\"/>\r\n          </feMerge>\r\n        </filter>\r\n        \r\n        {/* 各色のグラデーション定義 */}\r\n        <radialGradient id=\"purpleGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(270, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(270, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(270, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n        <radialGradient id=\"magentaGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(300, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(300, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(300, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n        <radialGradient id=\"pinkGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(330, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(330, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(330, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n        <radialGradient id=\"redGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(0, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(0, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(0, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n        <radialGradient id=\"orangeGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(30, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(30, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(30, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n        <radialGradient id=\"yellowGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(60, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(60, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(60, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n        <radialGradient id=\"yellowGreenGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(90, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(90, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(90, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n        <radialGradient id=\"greenGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(120, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(120, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(120, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n        <radialGradient id=\"blueGreenGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(150, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(150, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(150, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n        <radialGradient id=\"cyanGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(180, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(180, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(180, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n        <radialGradient id=\"lightBlueGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(210, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(210, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(210, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n        <radialGradient id=\"blueGlow\">\r\n          <stop offset=\"0%\" stopColor=\"hsl(240, 85%, 75%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"70%\" stopColor=\"hsl(240, 85%, 60%)\" stopOpacity=\"1\"/>\r\n          <stop offset=\"100%\" stopColor=\"hsl(240, 85%, 50%)\" stopOpacity=\"1\"/>\r\n        </radialGradient>\r\n      </defs>\r\n      \r\n      {/* 12色の円を正確な円環状に配置（赤を3時の位置に）- フレア効果付き */}\r\n      {/* 中心(256,256)、半径150pxの円周上に12個の円を30度間隔で配置 */}\r\n      <circle cx=\"256\" cy=\"106\" r=\"32\" fill=\"url(#purpleGlow)\" filter=\"url(#flare)\"/> {/* 12時: 紫 */}\r\n      <circle cx=\"331\" cy=\"131\" r=\"32\" fill=\"url(#magentaGlow)\" filter=\"url(#flare)\"/> {/* 1時: マゼンタ */}\r\n      <circle cx=\"385.8\" cy=\"181\" r=\"32\" fill=\"url(#pinkGlow)\" filter=\"url(#flare)\"/> {/* 2時: ピンク */}\r\n      <circle cx=\"406\" cy=\"256\" r=\"32\" fill=\"url(#redGlow)\" filter=\"url(#flare)\"/> {/* 3時: 赤 */}\r\n      <circle cx=\"385.8\" cy=\"331\" r=\"32\" fill=\"url(#orangeGlow)\" filter=\"url(#flare)\"/> {/* 4時: オレンジ */}\r\n      <circle cx=\"331\" cy=\"381\" r=\"32\" fill=\"url(#yellowGlow)\" filter=\"url(#flare)\"/> {/* 5時: 黄 */}\r\n      <circle cx=\"256\" cy=\"406\" r=\"32\" fill=\"url(#yellowGreenGlow)\" filter=\"url(#flare)\"/> {/* 6時: 黄緑 */}\r\n      <circle cx=\"181\" cy=\"381\" r=\"32\" fill=\"url(#greenGlow)\" filter=\"url(#flare)\"/> {/* 7時: 緑 */}\r\n      <circle cx=\"126.2\" cy=\"331\" r=\"32\" fill=\"url(#blueGreenGlow)\" filter=\"url(#flare)\"/> {/* 8時: 青緑 */}\r\n      <circle cx=\"106\" cy=\"256\" r=\"32\" fill=\"url(#cyanGlow)\" filter=\"url(#flare)\"/> {/* 9時: シアン */}\r\n      <circle cx=\"126.2\" cy=\"181\" r=\"32\" fill=\"url(#lightBlueGlow)\" filter=\"url(#flare)\"/> {/* 10時: 水色 */}\r\n      <circle cx=\"181\" cy=\"131\" r=\"32\" fill=\"url(#blueGlow)\" filter=\"url(#flare)\"/> {/* 11時: 青 */}\r\n    </svg>\r\n  );\r\n};","import { useState, useCallback, useEffect } from 'react';\r\nimport { ColorCircles } from '@features/color-adjustment/components/ColorCircles';\r\nimport { ColorAdjuster } from '@features/color-adjustment/ColorAdjuster';\r\nimport { ImageUploader } from '@features/image-viewer/components/ImageUploader';\r\nimport { ImageViewer } from '@features/image-viewer/ImageViewer';\r\nimport { CameraCapture } from '@features/camera/CameraCapture';\r\nimport { ColorVolumeViewer3D } from '@features/color-adjustment/components/ColorVolumeViewer3D';\r\nimport { AboutModal } from '@components/ui/AboutModal';\r\nimport { ColorWheelIcon } from '@features/color-adjustment/components/ColorWheelIcon';\r\nimport type { ColorVisionSettings, ImageFileInfo, ImageProcessingState } from '@/types/color';\r\nimport './App.css';\r\n\r\nfunction App() {\r\n  const [colorVisionSettings, setColorVisionSettings] = useState<ColorVisionSettings>({\r\n    simulation: {\r\n      useSimulation: false,\r\n      simulationType: 'deuteranopia',\r\n      severity: 0.2,\r\n      showSimulationInfo: false,\r\n    },\r\n    correction: {\r\n      useCorrection: false,\r\n      correctionType: 'deuteranopia',\r\n      strength: 0.2,\r\n    },\r\n    specialEffect: {\r\n      enabled: false,\r\n      type: 'double-light',\r\n      intensity: 0.5,\r\n      details: {\r\n        doubleLight: {\r\n          light1Position: { x: 0.25, y: 0.25 },\r\n          light2Position: { x: 0.75, y: 0.75 }\r\n        },\r\n        glitch: {\r\n          offsetAmount: 2,\r\n          noiseLevel: 0.1\r\n        },\r\n        depth: {\r\n          focusedRing: undefined\r\n        },\r\n        munker: {\r\n          stripeWidth: 8,\r\n          stripePattern: 'red-green'\r\n        },\r\n        watercolor: {\r\n          blurRadius: 5,\r\n          spreadAmount: 0.3\r\n        }\r\n      }\r\n    },\r\n    colorSet: 'hsl-standard',\r\n  });\r\n\r\n  // 画像・カメラ機能の状態\r\n  const [currentTab, setCurrentTab] = useState<'rgb' | 'image' | 'camera' | '3d'>('rgb');\r\n\r\n  // モーダル関連の状態\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [modalSection, setModalSection] = useState<'about' | 'credits' | 'privacy' | 'disclaimer'>('about');\r\n  const [imageInfo, setImageInfo] = useState<ImageFileInfo | null>(null);\r\n  const [processingState, setProcessingState] = useState<ImageProcessingState>({\r\n    isProcessing: false,\r\n    progress: 0,\r\n    error: null\r\n  });\r\n\r\n  // ウィンドウサイズの管理\r\n  const [windowWidth, setWindowWidth] = useState<number>(window.innerWidth);\r\n\r\n  // 処理状態変更ハンドラ（useCallbackでメモ化）\r\n  const handleProcessingStateChange = useCallback((isProcessing: boolean, progress: number, error?: string) => {\r\n    setProcessingState({\r\n      isProcessing,\r\n      progress,\r\n      error: error || null\r\n    });\r\n  }, []);\r\n\r\n  // ウィンドウサイズの変更を監視\r\n  useEffect(() => {\r\n    const handleResize = () => {\r\n      setWindowWidth(window.innerWidth);\r\n    };\r\n\r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  // ローカルストレージから設定を読み込み\r\n  useEffect(() => {\r\n    const savedColorVisionSettings = localStorage.getItem('colorwise-color-vision-settings');\r\n    if (savedColorVisionSettings) {\r\n      try {\r\n        const parsed = JSON.parse(savedColorVisionSettings);\r\n        setColorVisionSettings(parsed);\r\n      } catch (error) {\r\n        console.error('色覚設定の読み込みに失敗しました:', error);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // 設定が変更されたらローカルストレージに保存\r\n  useEffect(() => {\r\n    localStorage.setItem('colorwise-color-vision-settings', JSON.stringify(colorVisionSettings));\r\n  }, [colorVisionSettings]);\r\n\r\n  // モーダル制御ハンドラー\r\n  const openModal = (section: 'about' | 'credits' | 'privacy' | 'disclaimer') => {\r\n    setModalSection(section);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const closeModal = () => {\r\n    setShowModal(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"app\">\r\n      <header className=\"app-header\">\r\n        <div className=\"container\">\r\n          <h1 className=\"app-title\">\r\n            <ColorWheelIcon size=\"large\" className=\"app-logo\" />\r\n            ColorWise\r\n          </h1>\r\n          <p className=\"app-subtitle\">\r\n            ColorWise - 色の世界を、もっと楽しく\r\n          </p>\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"app-main\">\r\n        {/* タブナビゲーション */}\r\n        <nav className=\"tab-navigation\">\r\n          <div className=\"tab-buttons\">\r\n            <button\r\n              onClick={() => setCurrentTab('rgb')}\r\n              className={`tab-button ${currentTab === 'rgb' ? 'active' : ''}`}\r\n            >\r\n              プレビュー\r\n            </button>\r\n            <button\r\n              onClick={() => setCurrentTab('image')}\r\n              className={`tab-button ${currentTab === 'image' ? 'active' : ''}`}\r\n            >\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\" style={{ marginRight: '0.5rem', verticalAlign: 'middle' }}>\r\n                <path d=\"M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z\" />\r\n                <circle cx=\"12\" cy=\"12\" r=\"3\" />\r\n              </svg>\r\n              写真\r\n            </button>\r\n            <button\r\n              onClick={() => setCurrentTab('camera')}\r\n              className={`tab-button ${currentTab === 'camera' ? 'active' : ''}`}\r\n            >\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" style={{ marginRight: '0.5rem', verticalAlign: 'middle' }}>\r\n                <path d=\"M14.5 4h-5L7 7H4a2 2 0 00-2 2v9a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2h-3l-2.5-3z\" />\r\n                <circle cx=\"12\" cy=\"13\" r=\"3\" />\r\n              </svg>\r\n              カメラ\r\n            </button>\r\n            <button\r\n              onClick={() => setCurrentTab('3d')}\r\n              className={`tab-button ${currentTab === '3d' ? 'active' : ''}`}\r\n            >\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" style={{ marginRight: '0.5rem', verticalAlign: 'middle' }}>\r\n                <path d=\"M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z\" />\r\n                <polyline points=\"3.27 6.96 12 12.01 20.73 6.96\" />\r\n                <line x1=\"12\" y1=\"22.08\" x2=\"12\" y2=\"12\" />\r\n              </svg>\r\n              3D\r\n            </button>\r\n          </div>\r\n        </nav>\r\n\r\n        <div className=\"container\">\r\n          <div className={currentTab === 'rgb' ? 'app-content' : ''}>\r\n            {/* RGB調整タブ */}\r\n            {currentTab === 'rgb' && (\r\n              <>\r\n                <section className=\"visualization-section\">\r\n                  <div className=\"visualization-wrapper\">\r\n                    <ColorCircles\r\n                      colorVisionSettings={colorVisionSettings}\r\n                    />\r\n                  </div>\r\n                  <div className=\"section-description\">\r\n                    <p>\r\n                      24色相環で様々な色の見え方を、色覚シミュレーションや補正の効果をリアルタイムでプレビューできます。\r\n                      設定パネルで調整してください。\r\n                    </p>\r\n                  </div>\r\n                </section>\r\n\r\n                <section className=\"adjustment-section\">\r\n                  <ColorAdjuster\r\n                    colorVisionSettings={colorVisionSettings}\r\n                    onColorVisionSettingsChange={setColorVisionSettings}\r\n                  />\r\n                </section>\r\n              </>\r\n            )}\r\n\r\n            {/* 写真処理タブ */}\r\n            {currentTab === 'image' && (\r\n              <div style={{\r\n                display: 'grid',\r\n                gridTemplateColumns: windowWidth > 768 ? '350px 1fr' : '1fr',\r\n                gap: '2rem',\r\n                alignItems: 'start'\r\n              }}>\r\n                <div style={{\r\n                  position: windowWidth > 1400 ? 'sticky' : 'static',\r\n                  top: '1rem'\r\n                }}>\r\n                  <h2 className=\"section-title\" style={{ color: '#9CA3AF', marginBottom: '1rem' }}>Settings</h2>\r\n                  <ColorAdjuster\r\n                    colorVisionSettings={colorVisionSettings}\r\n                    onColorVisionSettingsChange={setColorVisionSettings}\r\n                  />\r\n                  <div style={{ marginTop: '2rem' }}>\r\n                    <ImageUploader\r\n                      onImageLoad={setImageInfo}\r\n                      processingState={processingState}\r\n                      disabled={processingState.isProcessing}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div style={{ width: '100%' }}>\r\n                  <ImageViewer\r\n                    imageInfo={imageInfo}\r\n                    colorVisionSettings={colorVisionSettings}\r\n                    onProcessingStateChange={handleProcessingStateChange}\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* カメラタブ */}\r\n            {currentTab === 'camera' && (\r\n              <div style={{\r\n                display: 'grid',\r\n                gridTemplateColumns: windowWidth > 768 ? '350px 1fr' : '1fr',\r\n                gap: '2rem',\r\n                alignItems: 'start'\r\n              }}>\r\n                <div style={{\r\n                  position: windowWidth > 1400 ? 'sticky' : 'static',\r\n                  top: '1rem'\r\n                }}>\r\n                  <h2 className=\"section-title\" style={{ color: '#9CA3AF', marginBottom: '1rem' }}>Settings</h2>\r\n                  <ColorAdjuster\r\n                    colorVisionSettings={colorVisionSettings}\r\n                    onColorVisionSettingsChange={setColorVisionSettings}\r\n                  />\r\n                </div>\r\n                <div style={{ width: '100%' }}>\r\n                  <CameraCapture\r\n                    colorVisionSettings={colorVisionSettings}\r\n                    onProcessingStateChange={handleProcessingStateChange}\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* 3Dビューアタブ */}\r\n            {currentTab === '3d' && (\r\n              <div style={{\r\n                display: 'grid',\r\n                gridTemplateColumns: windowWidth > 768 ? '350px 1fr' : '1fr',\r\n                gap: '2rem',\r\n                alignItems: 'start'\r\n              }}>\r\n                <div style={{\r\n                  position: windowWidth > 1400 ? 'sticky' : 'static',\r\n                  top: '1rem'\r\n                }}>\r\n                  <h2 className=\"section-title\" style={{ color: '#9CA3AF', marginBottom: '1rem' }}>Info</h2>\r\n                  <div style={{\r\n                    padding: '1.5rem',\r\n                    background: '#FFFFFF',\r\n                    borderRadius: '1rem',\r\n                    boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)',\r\n                    fontSize: '0.875rem',\r\n                    color: '#475569',\r\n                    lineHeight: '1.6'\r\n                  }}>\r\n                    <h3 style={{ fontSize: '1rem', fontWeight: '600', color: '#1e293b', marginBottom: '0.75rem' }}>Oklab 3D Volume</h3>\r\n                    <p>\r\n                      この3D表示は、Oklab色空間内での<b>sRGBガモット（表現可能な色の範囲）</b>の形状を可視化したものです。\r\n                    </p>\r\n                    <p style={{ marginTop: '0.5rem' }}>\r\n                      中心を通る垂直な軸は<b>明度(L)</b>を表し、外側に向かって<b>彩度(C)</b>が高くなります。\r\n                    </p>\r\n                    <p style={{ marginTop: '0.5rem' }}>\r\n                      HSLなどの円柱モデルとは異なり、知覚的に均一なOklab空間では、色によって表現可能な彩度の限界が異なることが分かります（歪んだコマのような形状）。\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div style={{ width: '100%' }}>\r\n                  <ColorVolumeViewer3D settings={colorVisionSettings} />\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n        </div>\r\n      </main>\r\n\r\n      <footer className=\"app-footer\">\r\n        <div className=\"container\">\r\n          <p className=\"footer-text\">\r\n            © 2025 ColorWise - 色の世界を、もっと楽しく | v{import.meta.env.VITE_APP_VERSION}\r\n          </p>\r\n          <p className=\"footer-links\">\r\n            <button onClick={() => openModal('about')} className=\"footer-link\" style={{ background: 'none', border: 'none', color: 'inherit', textDecoration: 'underline', cursor: 'pointer' }}>このアプリについて</button>\r\n            <span className=\"footer-separator\">|</span>\r\n            <button onClick={() => openModal('credits')} className=\"footer-link\" style={{ background: 'none', border: 'none', color: 'inherit', textDecoration: 'underline', cursor: 'pointer' }}>クレジット</button>\r\n            <span className=\"footer-separator\">|</span>\r\n            <button onClick={() => openModal('privacy')} className=\"footer-link\" style={{ background: 'none', border: 'none', color: 'inherit', textDecoration: 'underline', cursor: 'pointer' }}>プライバシーポリシー</button>\r\n            <span className=\"footer-separator\">|</span>\r\n            <button onClick={() => openModal('disclaimer')} className=\"footer-link\" style={{ background: 'none', border: 'none', color: 'inherit', textDecoration: 'underline', cursor: 'pointer' }}>免責事項</button>\r\n          </p>\r\n        </div>\r\n      </footer>\r\n\r\n      <AboutModal\r\n        isOpen={showModal}\r\n        onClose={closeModal}\r\n        activeSection={modalSection}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;","import React from 'react'\r\nimport ReactDOM from 'react-dom/client'\r\nimport App from './App.tsx'\r\nimport './index.css'\r\n\r\nReactDOM.createRoot(document.getElementById('root')!).render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n)\r\n\r\n// Service Worker registration\r\nif ('serviceWorker' in navigator) {\r\n  window.addEventListener('load', () => {\r\n    navigator.serviceWorker.register(import.meta.env.BASE_URL + 'sw.js')\r\n      .then(async (registration) => {\r\n        // 古いSWがいる場合は更新を即時適用\r\n        if (registration.waiting) {\r\n          registration.waiting.postMessage({ type: 'SKIP_WAITING' });\r\n        } else if (registration.installing) {\r\n          registration.installing.addEventListener('statechange', () => {\r\n            if (registration.waiting) {\r\n              registration.waiting.postMessage({ type: 'SKIP_WAITING' });\r\n            }\r\n          });\r\n        }\r\n      })\r\n      .catch(() => {\r\n        // Service Worker registration failed\r\n      });\r\n  });\r\n}"],"names":["f","require$$0","k","l","m","n","p","q","c","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","client","srgbToLinear","linearToSrgb","applyMat3","v","x","y","z","clamp01","clamp255","polyfitLeastSquares","xs","ys","degree","A","i","val","j","AT","transpose","ATA","matMul","ATb","matVecMul","gaussianSolve","M","rows","cols","T","B","r","out","sum","t","Ain","bIn","row","maxRow","pivot","factor","MACHADO_DEUTERANOMALY","buildPolynomialCoeffs","data","coeffs","evalPoly","acc","evaluateMatrix","s","ss","DEGREE","COEFFS","simulateDeutanPoly","rgb","severity","createDeutanSimulator","lin","R","G","correctForDeutan","strength","headroom","createDeutanCorrector","headroomScale","blendRatio","TM_START","tmStrength","linOrig","linScaled","simulateLin","X","Y","alpha","Sx","err","linCorrectedFull","linOut","mapped","oklabToLinearSrgb","L","l_","m_","s_","oklabToRgb","lr","lg","lb","isInGamut","eps","findMaxChroma","hue","low","high","mid","hslToRgb","hue2rgb","ColorWheel","colorVisionSettings","width","height","canvasRef","useRef","offscreenCanvasRef","selectedColor","setSelectedColor","useState","effectEnabled","colorData","setColorData","isInitialized","setIsInitialized","defaultSize","canvasSize","setCanvasSize","ripplesRef","particlesRef","animationFrameRef","calculateColorData","useCallback","canvas","size","dpr","ctx","centerX","centerY","baseRadius","newColorData","colorSet","applyColorVision","result","ringRadii","circleSizes","ring","radius","circleSize","lightness","saturation","angle","rawRgb","finalRgb","chromaSet","rawRgbObj","centerCircleSize","centerRgb","hexToRgb","hex","rgbToHsl","max","min","apply3DLighting","colorInfo","intensity","baseRgb","rgbString","match","gradient","pinkIntensity","blueIntensity","pinkLight","blueLight","applyDepthEffect","maxDist","dist","distanceFactor","saturationReduction","lightnessIncrease","hsl","adjustedRgb","adjustedColor","sizeMultiplier","applySpecialEffect","specialEffect","finalColor","finalSize","skipDrawing","drawGlitchEffect","offset","smallOffset","updateOffscreenCanvas","offscreen","drawMunkerBackgroundStripes","stripeWidth","stripePattern","bgColor","drawMunkerForegroundStripes","fgColor","effectResult","render","currentTime","ripple","progress","startRadius","endRadius","particle","newX","newY","newLife","lineWidth","useEffect","handleResize","newSize","startRippleEffect","color","newRipple","startParticleEffect","newParticles","speed","particleColor","particleSize","handleCanvasClick","event","rect","clickX","clickY","scaleX","scaleY","canvasX","canvasY","nearestColor","minDistance","distance","jsxs","jsx","_a","_b","_c","ColorCircles","Fragment","colorSetOptions","ColorSetSelector","selectedSet","onSelect","styles","option","clamp","value","ColorAdjuster","onColorVisionSettingsChange","handleColorSetChange","handleSimulationToggle","handleSimulationTypeChange","type","handleSimulationSeverityChange","handleCorrectionToggle","handleCorrectionTypeChange","handleCorrectionStrengthChange","handleCorrectionHeadroomChange","handleSpecialEffectToggle","handleSpecialEffectTypeChange","handleSpecialEffectIntensityChange","newPattern","processImageData","imageData","onProgress","totalPixels","batchSize","processedPixels","endIndex","transformedRgb","resolve","loadImageToCanvas","file","maxWidth","maxHeight","reject","img","ratio","drawImageDataToCanvas","downloadCanvasAsImage","filename","format","quality","blob","url","formatFileSize","bytes","sizes","validateImageFile","maxSize","ImageUploader","onImageLoad","processingState","disabled","dragOver","setDragOver","handleFileSelect","validationError","imageInfo","handleFileInput","handleDrop","handleDragOver","handleDragLeave","ImageViewer","onProcessingStateChange","originalCanvasRef","processedCanvasRef","viewMode","setViewMode","originalImageData","setOriginalImageData","processedImageData","setProcessedImageData","timeoutId","processed","handleDownload","CameraCapture","videoRef","cameraConfig","setCameraConfig","devices","setDevices","stream","setStream","isProcessingFrame","setIsProcessingFrame","videoDevices","device","error","toggleCamera","track","prev","constraints","mediaStream","errorMessage","captureAndProcess","video","originalCanvas","processedCanvas","capturePhoto","ColorVolumeViewer3D","settings","angleX","setAngleX","angleY","setAngleY","zoom","setZoom","autoRotate","setAutoRotate","points","useMemo","pts","C","processedPoints","isDeutanSimulation","isDeutanCorrection","simulate","correct","rotateX","cos","sin","rotateY","project","zScale","scale","pt","proj","frameId","isDragging","lastMousePos","handleMouseDown","handleMouseMove","dx","dy","handleMouseUp","handleWheel","next","AboutModal","isOpen","onClose","activeSection","renderContent","ColorWheelIcon","className","style","iconSize","App","setColorVisionSettings","currentTab","setCurrentTab","showModal","setShowModal","modalSection","setModalSection","setImageInfo","setProcessingState","windowWidth","setWindowWidth","handleProcessingStateChange","isProcessing","savedColorVisionSettings","parsed","openModal","section","closeModal","ReactDOM","React","registration"],"mappings":"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","x_google_ignoreList":[0,1,2]}